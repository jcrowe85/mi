{% comment %}
  	Renders a product card
  	Accepts:
  	- product_card_product: {Object} Product Liquid object (optional)
  	- media_size: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
  	- show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
  	- show_vendor: {Boolean} Show the product vendor. Default: true
  	- show_desc: {Boolean} Show the product vendor. Default: false
  	- section_id: {String} The ID of the section that contains this card.
  	- show_sku: {Boolean} Show sku. Default: false
  	Usage:
  {% render 'product-card', show_vendor: section.settings.show_vendor %}
{% endcomment %}

{%- if settings.quickview_button_type != 'none' -%}
  <link
    rel="preload"
    href="{{ 'section-main-product.css' | asset_url }}"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  >
  <link
    rel="stylesheet"
    href="{{ 'component-deferred-media.css' | asset_url }}"
    media="all"
  >
  <link
    rel="preload"
    href="{{ 'quick-add.css' | asset_url }}"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  >
  {%- assign first_3d_model = product_card_product.media | where: 'media_type', 'model' | first -%}
  {%- if first_3d_model -%}
    {{ 'component-product-model.css' | asset_url | stylesheet_tag }}
    <link
      id="ModelViewerStyle"
      rel="stylesheet"
      href="https://cdn.shopify.com/shopifycloud/model-viewer-ui/assets/v1.0/model-viewer-ui.css"
      media="print"
      onload="this.media='all'"
    >
    <link
      id="ModelViewerOverride"
      rel="stylesheet"
      href="{{ 'component-model-viewer-ui.css' | asset_url }}"
      media="print"
      onload="this.media='all'"
    >
  {%- endif -%}
  {%- if first_3d_model -%}
    <script type="application/json" id="ProductJSON-{{ product.id }}">
      {{ product_card_product.media | where: 'media_type', 'model' | json }}
    </script>
    <script src="{{ 'product-model.js' | asset_url }}" defer></script>
  {%- endif -%}
{%- endif -%}
{% liquid
  case media_size
    when 'landscape'
      assign image_size = '70%'
    when 'portrait'
      assign image_size = '130%'
    when 'square'
      assign image_size = '100%'
    else
      assign image_size = '130%'
  endcase

  if media_fit == blank
    assign imgae_fit = 'cover'
  else
    assign imgae_fit = media_fit
  endif
%}
{%- assign product_form_id = 'quick-add-' | append: section_id | append: product_card_product.id -%}
<div
  class="card-wrapper js-color-swatches-wrapper quickview{%- if settings.quickview_hover -%}--hover{% endif %}"
  data-product="{{ product_card_product.handle }}"
>
  <a class="full-overlay-link" href="{{ product_card_product.url }}"></a>
  <div class="floating-tags-list">
    {% for tag in product_card_product.tags %} 
      <span class="product-tag tag-{{ tag }}">{{ tag }}</span>
    {% endfor %}
  </div>

  <span class="visually-hidden">{{ product_card_product.title | escape }}</span>
  <div class="product_card_product-top-details">
  {% if product_card_product.metafields.custom.product_info_code != blank %}
    <span class="special_code">{{ product_card_product.metafields.custom.product_info_code }}</span>
  {% endif %}
  <h3 class="card__title" style="font-weight: bold">
          <a
            class="unstyled-link "
            href="{{ product_card_product.url | default: '#' }}"
            title="{{ product_card_product.title | escape }}"
          >
            {{ product_card_product.title | escape -}}
          </a>
        {% unless hide_product_reviews %}
          <div class="jdgm-widget jdgm-preview-badge">
            {{ product_card_product.metafields.judgeme.badge }}
          </div>
        {% endunless %} 
        </h3>
        </div>
  <div class="card card--product" tabindex="-1">
    <a
      href="{{ product_card_product.url | default: '#' }}"
      class="media media--hover-effect js-color-swatches-link"
      aria-label="{{ "accessibility.product_link" | t }}"
      style="padding-bottom: {{ image_size }};"
    >
      {%- if product_card_product.featured_media -%}
        {%- capture style -%}
					object-position: {{ product_card_product.featured_media.presentation.focal_point }};
					object-fit : {{ imgae_fit }};
				{%- endcapture -%}
        {% if product_card_product.metafields.custom.grid_featured_image != blank %}
        <img src="{{ product_card_product.metafields.custom.grid_featured_image | image_url:width:'800px' }}" width="" height="" alt="">
        {% else %}
        {{
          product_card_product.featured_media
          | image_url: width: 1920
          | image_tag:
            loading: 'lazy',
            width: product_card_product.featured_media.width,
            height: image_height,
            sizes: '(max-width: 576px) 100vw, (max-width: 1200px) 50vw, 100vw',
            widths: '375, 550, 750, 1100, 1500, 1700, 1900',
            class: 'motion-reduce media--first',
            style: style
        }}
      {% endif %}
        {%- if product_card_product.media[1] != null and show_secondary_image -%}
          {%- capture style -%}
							object-position: {{ product_card_product.media[1].presentation.focal_point }};
							object-fit : {{ imgae_fit }};
						{%- endcapture -%}
          {{
            product_card_product.media[1]
            | image_url: width: 1920
            | image_tag:
              loading: 'lazy',
              width: product_card_product.media[1].width,
              height: image_height,
              sizes: '(max-width: 576px) 100vw, (max-width: 1200px) 50vw, 100vw',
              widths: '375, 550, 750, 1100, 1500, 1700, 1900',
              class: 'motion-reduce media--second',
              style: style
          }}
        {%- endif -%}
      {%- else -%}
        {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg' }}
      {%- endif -%}
    </a>

    <div class="card__badge">
      {%- if product_card_product.available == false -%}
        <span
          class="badge badge--bottom-left color-{{ settings.sold_out_badge_color_scheme }}"
          aria-hidden="true"
        >
          {{- 'products.product.sold_out' | t -}}
        </span>
      {%- elsif product_card_product.compare_at_price > product_card_product.price
        and product_card_product.available
      -%}
        <!--
          <span
          	class="badge badge--bottom-left color-{{ settings.sale_badge_color_scheme }}"
          	aria-hidden="true"
          >
          	{{- 'products.product.on_sale' | t -}}
          </span>
        -->
      {%- endif -%}
    </div>
  </div>
  <div class="card-information">
    <div class="card-information__wrapper">
      {%- if show_sku and product_card_product.selected_or_first_available_variant.sku.size > 0 -%}
        <p
          class="card__sku subtitle no-js-hidden"
          id="Sku-{{ section.id }}"
          role="status"
          {{ block.shopify_attributes }}
        >
          <span class="visually-hidden">{{ 'products.product.sku' | t }}:</span>
          {{- product_card_product.selected_or_first_available_variant.sku -}}
        </p>
      {%- endif -%}
      {%- if show_vendor -%}
        <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
        {% comment %}
          <div class="caption-with-letter-spacing subtitle">
          	{{ product_card_product.vendor }}
          </div>
        {% endcomment %}
        {% if settings.enable_vendor_link %}
          <a
            href="{{ product_card_product.vendor | url_for_vendor }}"
            class="unstyled-link caption-with-letter-spacing vendor-link subtitle"
          >
            {{ product_card_product.vendor }}
          </a>
        {% else %}
          <div class="caption-with-letter-spacing subtitle">
            {{ product_card_product.vendor }}
          </div>
        {%- endif -%}
      {%- endif -%}
      <div class="card-information-block">
       
        {% unless hide_product_reviews %}
          <div class="jdgm-widget jdgm-preview-badge">
            {{ product_card_product.metafields.judgeme.badge }}
          </div>
        {% endunless %} 

        {% if product_card_product.metafields.custom.product_summary %}
          <p style="font-weight: normal; margin-top: 6px; margin-bottom: 16px;" class="product_summary {% if hide_product_summary %}hide hidden{% endif %}">
            {{ product_card_product.metafields.custom.product_summary }}
          </p>
        {% endif %}

          {% if product.metafields.custom.product_short_description %}
            <div class="product__short-description">
              {{ product.metafields.custom.product_short_description }}
            </div>
          {% endif %} 

        <div class="quick-add no-js-hidden"> 
            <!-- Button dynamic redirect set with javascript click listener in popular-products.liquid -->
            <button
              id="{{ product_form_id }}-submit"
              data-product-url="{{ product_card_product.url | default: '#' }}"
              type="submit"
              name="add"
              class="card__link button button--{{ settings.quickview_button_style }} card__link--{{ settings.quickview_button_layout }} {%- if settings.show_on_mobile == false -%}mobile-hide{%- endif -%} card-focused{% if settings.quickview_button_style == 'link' %} button--primary{% endif %}"
              aria-haspopup="dialog"
              aria-label="quick-view-button"
              aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ product_card_product.id }}"
              data-product-url="{{ product_card_product.url }}"
            >
              {% if settings.quickview_button_style == 'link' %}
                {% render 'icon-eye' %}
              {% else %}
                <span class="card__quickview-text" style="font-weight: normal">
                  <!-- <p>{{- 'general.card.quick__view' | t -}}</p> -->
                  <p>Shop Now</p>
                  <span class="button-icon"> <svg class="icon icon-button-arrow" width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M7.97218 1L12.8333 6M12.8333 6L7.97218 11M12.8333 6L1.16663 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </span>
                {% if pro_hide_price_inner_btn %}    <span class="button-icon">
				<svg class="icon icon-button-arrow" width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M7.97218 1L12.8333 6M12.8333 6L7.97218 11M12.8333 6L1.16663 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>

			</span>{% endif %}
                 
                </span>
              {% endif %}
              <b class="loading-overlay__spinner hidden">
                <svg
                  aria-hidden="true"
                  focusable="false"
                  role="presentation"
                  class="spinner"
                  viewBox="0 0 66 66"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                </svg>
              </b>
            </button>
        </div>
         {% unless pro_hide_price_inner_btn %} 
                {% render 'price', product: product_card_product, price_class: '' %}{% endunless %}
      </div>
      {%- if show_desc and product_card_product.description != blank -%}
        {{ product_card_product.collections.title }}
        <div class="card__description">
          {{ product_card_product.description | strip_html | truncate: 120 }}
        </div>
      {%- endif -%}
      {%- if show_collection_name -%}
        {%- for collection in product_card_product.collections limit: 1 -%}
          <a
            href="{{ collection.url }}"
            class="card__collection-title extra_small-font unstyled-link"
          >
            {{- collection.title | escape -}}
          </a>
        {%- endfor -%}
      {%- endif -%}
      {%- unless product_card_product.has_only_default_variant -%}
        {% if show_color_swatch and settings.show_color_swatch %}
          <div class="product-parameters no-js-hidden">
            {%- for option in product_card_product.options_with_values -%}
              {% liquid
                assign color_trigger = settings.trigger_swatch | handle | strip
                assign name_option = option.name | handle | strip
              %}
              {% if color_trigger == name_option %}
                <div class="product-form__controls js-color-swatches">
                  <div class="product-form__controls-group color--silwer">
                    {% render 'product-variant-options',
                      product: product_card_product,
                      option: option,
                      no_form_id: true
                    %}
                  </div>
                </div>
              {% endif %}
            {%- endfor -%}
          </div>
        {% endif %}
      {% endunless %}
    </div>
  </div>
</div>