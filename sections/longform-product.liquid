{{ 'section-main-product.css' | asset_url | stylesheet_tag }}
{{ 'component-accordion.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-rte.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

<link rel="stylesheet" href="{{ 'component-cart-drawer.css' | asset_url }}" media="all">
<link rel="stylesheet" href="{{ 'component-deferred-media.css' | asset_url }}" media="all">

<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'copy.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'product-single.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'update-slider.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'about.js' | asset_url }}" defer="defer"></script>

{% style %}
  	.section-{{ section.id }}-padding {
  	{% if section.settings.padding_top == 'no-indent' %}
  		padding-top: 0;
  	{% else %}
  		padding-top: 3.2rem;
  	{% endif %}

  	{% if section.settings.padding_bottom == 'no-indent' %}
  		padding-bottom: 0;
  	{% else %}
  		padding-bottom: 3.2rem;
  	{% endif %}
  }

  @media screen and (min-width: 990px) {
  	.section-{{ section.id }}-padding {
  		{% if section.settings.padding_top == 'no-indent' %}
  			padding-top: 0;
  		{% elsif section.settings.padding_top == 'l' %}
  			padding-top: 4rem;
  		{% else %}
  			padding-top: 3.2rem;
  		{% endif %}

  		{% if section.settings.padding_bottom == 'no-indent' %}
  			padding-bottom: 0;
  		{% elsif section.settings.padding_bottom == 'l' %}
  			padding-bottom: 4rem;
  		{% else %}
  			padding-bottom: 3.2rem;
  		{% endif %}
  	}
  }

  @media screen and (min-width: 1200px) {
  	.section-{{ section.id }}-padding {
  		{% if section.settings.padding_top == 'no-indent' %}
  			padding-top: 0;
  		{% elsif section.settings.padding_top == 'l' %}w3q4
  			padding-top: 8rem;
  		{% elsif section.settings.padding_top == 'm' %}
  			padding-top: 4rem;
  		{% else %}
  			padding-top: 3.2rem;
  		{% endif %}

  		{% if section.settings.padding_bottom == 'no-indent' %}
  			padding-bottom: 0;
  		{% elsif section.settings.padding_bottom == 'l' %}
  			padding-bottom: 8rem;
  		{% elsif section.settings.padding_bottom == 'm' %}
  			padding-bottom: 4rem;
  		{% else %}
  			padding-bottom: 3.2rem;
  		{% endif %}
  	}
  }

  @media screen and (min-width: 1560px) {
  	.section-{{ section.id }}-padding {
  		{% if section.settings.padding_top == 'no-indent' %}
  			padding-top: 0;
  		{% elsif section.settings.padding_top == 'l' %}
  			padding-top: 16rem;
  		{% elsif section.settings.padding_top == 'm' %}
  			padding-top: 8rem;
  		{% elsif section.settings.padding_top == 's' %}
  			padding-top: 4rem;
  		{% else %}
  			padding-top: 3.2rem;
  		{% endif %}

  		{% if section.settings.padding_bottom == 'no-indent' %}
  			padding-bottom: 0;
  		{% elsif section.settings.padding_bottom == 'l' %}
  			padding-bottom: 16rem;
  		{% elsif section.settings.padding_bottom == 'm' %}
  			padding-bottom: 8rem;
  		{% elsif section.settings.padding_bottom == 's' %}
  			padding-bottom: 4rem;
  		{% else %}
  			padding-bottom: 3.2rem;
  		{% endif %}
  	}
  }
{% endstyle %}

{% comment %}
  {%- style -%}
    {% render 'section-padding' %}
  {%- endstyle -%}
{% endcomment %}

{%- assign first_3d_model = product.media | where: 'media_type', 'model' | first -%}
{%- if first_3d_model -%}
  {{ 'component-product-model.css' | asset_url | stylesheet_tag }}
  <link
    id="ModelViewerStyle"
    rel="stylesheet"
    href="https://cdn.shopify.com/shopifycloud/model-viewer-ui/assets/v1.0/model-viewer-ui.css"
    media="print"
    onload="this.media='all'"
  >
  <link
    id="ModelViewerOverride"
    rel="stylesheet"
    href="{{ 'component-model-viewer-ui.css' | asset_url }}"
    media="print"
    onload="this.media='all'"
  >
{%- endif -%}

<section
  class="container section-{{ section.id }}-padding color-{{ section.settings.color_scheme }} background main-pro-sec template-product-longform"
  id="MainProduct-{{ section.id }}"
  data-section="{{ section.id }}"
>
  <div class="product{% if product.media.size > 0 %} row{% else %} product--no-media{% endif %}{% if section.settings.image_gallery_collage == "stacked" %} product__stacked{% endif %}">
    <div class="product__outer{% if section.settings.desktop_alignment == 'left' %} product__outer--desktop-order{% endif %}{% if section.settings.mobile_alignment == 'after' %} product__outer--mobile-order{% endif %}">
      {% if section.settings.desktop_alignment == 'right' %}
        <style>
          @media screen and (min-width: 1023px) {
            .quick-add-modal__announcement-bar {
              width: 55%;
              left: 0;
              right: unset;
            }
          }
        </style>
      {% endif %}
      <div class="product__info-wrapper">
        <div id="ProductInfo-{{ section.id }}" class="product__info-container">
          {%- assign product_form_id = 'product-form-' | append: section.id -%}
          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {% when '@app' %}
                {% render block %}

              {%- when 'text' -%}
                <p class="product__text" {{ block.shopify_attributes }}>
                  {{- block.settings.text -}}
                </p>
              {%- when 'title' -%}
                <div class="product__title__wrapper {%- if product.available == false %} price--sold-out {% endif -%} {%- if product.compare_at_price > product.price %} price--on-sale {% endif -%}">
                  <h1 class="product__title h5" {{ block.shopify_attributes }}>
                    {{ product.title | escape }}
                  </h1>
                  {% if product.metafields.custom.product_formula %}
                    <div class="product__product_formula">
                      {{ product.metafields.custom.product_formula }}
                    </div>
                  {% endif %}
                  <div style="display: flex; align-items: center; gap: 0rem;">
                    <div class="review-stars">
                      {% comment %} {{ product.metafields.judgeme.badge }} {% endcomment %}
                      <span class="review-star"></span>
                      <span class="review-star"></span>
                      <span class="review-star"></span>
                      <span class="review-star"></span>
                      <span class="review-star"></span>
                      <span class="review-count">2.3k</span>
                      <span class="review-title">Reviews</span>
                    </div>
                    {% assign show_success = product.metafields.custom.show_success_rate %}
                    {% if show_success == true %}
                      <div
                        style="background-color: rgba(0, 0, 0, .07); border-radius: 5px;"
                        class="success-rate-badge {{product.metafields.custom.show_success_rate }}"
                      >
                        <p style="margin: 0; padding: 0; padding: .25rem .75rem; font-size: 12px; color: rgba(0, 0, 0, .6)">
                          {{ product.metafields.custom.success_rate | default: '91% success rate*' }}
                        </p>
                      </div>
                    {% endif %}
                  </div>
                  {% if product.metafields.custom.product_short_description %}
                    <div class="product__short-description">
                      {{ product.metafields.custom.product_short_description }}
                    </div>
                  {% endif %}
                </div>
              {%- when 'tags' -%}
                {%- if product.tags != blank -%}
                  <ul class="product-tags product__tags">
                    {% for tag in product.tags %}
                      <li class="product-tags__tag extra_small-font">{{ tag }}</li>
                    {% endfor %}
                  </ul>
                {%- endif -%}

              {% when 'about' %}
                <div class="product-about">
                  <div class="product-about__outer">
                    <div class="product-about__right">
                      <div class="product-about__wrapper no-js-hidden">
                        {% if block.settings.about_heading != blank %}
                          <div class="product-about__accordion-item" {{ block.shopify_attributes }}>
                            <h2 class="h6 product-about__accordion-title">
                              <span>{{ block.settings.about_heading }}</span>
                              <div class="product-about__more-link-wrapper">
                                <div class="product-about__more-link">
                                  {% render 'icon-arrow' %}
                                </div>
                              </div>
                            </h2>
                            <div
                              class="product-about__accordion-description product-about__accordion-content"
                              style="display: none"
                            >
                              {{ block.settings.about_heading_content }}
                            </div>
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>

                {% if block.settings.image != blank or block.settings.image1 != blank %}
                  <div class="before_after {% unless block.settings.show_undermedia %}blocks_undermedia{% endunless %}">
                    {% if block.settings.image != blank %}
                      <div class="before-after-media-wrep">
                        <img
                          src="{{ block.settings.image | image_url:width:'800px' }}"
                          width=""
                          height=""
                          alt="{{ block.settings.image.alt }}"
                          loading="lazy"
                        >
                        <p>{{ block.settings.text }}</p>
                      </div>
                    {% endif %}
                    {% if block.settings.image1 != blank %}
                      <div class="before-after-media-wrep">
                        <img
                          src="{{ block.settings.image1 | image_url:width:'800px' }}"
                          width=""
                          height=""
                          alt="{{ block.settings.image1.alt }}"
                          loading="lazy"
                        >
                        <p>{{ block.settings.text1 }}</p>
                      </div>
                    {% endif %}
                  </div>
                {% endif %}

              {%- when 'price' -%}
                <div class="no-js-hidden price-wrapper" id="price-{{ section.id }}" {{ block.shopify_attributes }}>
                  {%- render 'price',
                    product: product,
                    use_variant: true,
                    show_badges: true,
                    price_class: 'price--product'
                  -%}
                  {%- if cart.taxes_included or shop.shipping_policy.body != blank -%}
                    <div class="product__tax caption rte">
                      {%- if cart.taxes_included -%}
                        {{ 'products.product.include_taxes' | t }}
                      {%- endif -%}
                      {%- if shop.shipping_policy.body != blank -%}
                        {{ 'products.product.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                </div>
              {% when 'benefits_list' %}
                <div class="benefits_list product-about">
                  {% if block.settings.title != blank %}
                    <h4>{{ block.settings.title }}</h4>
                  {% endif %}
                  <ul class="">
                    {% assign item_count = 10 %}
                    {% for i in (1..item_count) %}
                      {% capture setting_id %}text_{{ i }}{% endcapture %}
                      {% assign benefit_text = block.settings[setting_id] %}

                      {% if benefit_text != blank %}
                        <li class="text-base">
                          <span>
                            {% comment %}
                              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect width="20" height="20" rx="4" fill="#D9D9D9"/>
                              </svg>
                            {% endcomment %}
                          </span>
                          {{ benefit_text }}
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>

              {% when 'description' %}
                {% assign default_open = block.settings.default_open %}
                {% if product.description != blank %}
                  {% if block.settings.description_variants == 'collapsible' %}
                    <div class="product-about">
                      <div class="product-about__outer">
                        <div class="product-about__right">
                          <div class="product-about__wrapper no-js-hidden">
                            <div class="product-about__accordion-item" {{ block.shopify_attributes }}>
                              <h2 class="h6 product-about__accordion-title{% if default_open %} active{% endif %}">
                                <span>{{ block.settings.description_heading }}</span>
                                <div class="product-about__more-link-wrapper">
                                  <div class="product-about__more-link">
                                    {% render 'icon-arrow' %}
                                  </div>
                                </div>
                              </h2>
                              <div
                                class="product-about__accordion-description product-about__accordion-content main-product-description"
                                {% if default_open %}
                                  style="display: block"
                                {% else %}
                                  style="display: none"
                                {% endif %}
                              >
                                {{ product.description }}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% elsif block.settings.description_variants == 'fixed' %}
                    <div class="product__description-fixed main-product-description">
                      {{ product.description }}
                    </div>
                  {% endif %}
                {% endif %}

              {%- when 'share' -%}
                {%- if block.settings.show_share_facebook
                  or block.settings.show_share_twitter
                  or block.settings.show_share_pinterest
                  or block.settings.show_share_copy
                -%}
                  <div class="share-buttons" aria-label="list">
                    <div class="share-buttons__label link-hover-line-outer">
                      <span class="share-buttons__label-name">{{ 'general.share.share' | t }}</span>
                    </div>

                    <ul class="share-buttons__list">
                      {%- if block.settings.show_share_facebook -%}
                        <li class="share-buttons__item">
                          <a
                            href="https://www.facebook.com/sharer.php?u={{ shop.url | append: product.url }}"
                            class="share-buttons__button link-hover-line-outer facebook-btn"
                            target="_blank"
                            aria-label="facebook"
                          >
                            {% render 'icon-facebook' %}
                          </a>
                        </li>
                      {%- endif -%}

                      {%- if block.settings.show_share_twitter -%}
                        <li class="share-buttons__item">
                          <a
                            href="https://twitter.com/share?url={{ shop.url | append: product.url }}&text={{ product.title | escape }}"
                            class="share-buttons__button link-hover-line-outer twitter-btn"
                            target="_blank"
                            aria-label="twitter"
                          >
                            {% render 'icon-twitter' %}
                          </a>
                        </li>
                      {%- endif -%}

                      {%- if block.settings.show_share_pinterest -%}
                        <li class="share-buttons__item">
                          <a
                            href="https://pinterest.com/pin/create/bookmarklet/?media={{ product.featured_media | img_url: '1100x1100' }}&url={{ shop.url | append: product.url }}&description={{ product.title | escape }}"
                            class="share-buttons__button link-hover-line-outer pinterest-btn"
                            target="_blank"
                            aria-label="pinterest"
                          >
                            {% render 'icon-pinterest' %}
                          </a>
                        </li>
                      {%- endif -%}

                      {%- if block.settings.show_share_copy -%}
                        <li class="share-buttons__item">
                          <a
                            href="{{ shop.url | append: product.url }}"
                            class="share-buttons__button link-hover-line-outer copy-btn"
                            aria-label="copy link"
                          >
                            {% render 'icon-copy' %}
                          </a>
                        </li>
                      {%- endif -%}
                    </ul>
                  </div>
                {%- endif -%}

              {%- when 'variant_picker' -%}
                {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}

              {%- when 'buy_buttons' -%}
                <div {{ block.shopify_attributes }}>
                  {%- liquid
                    assign gift_card_recipient_feature_active = false
                    if block.settings.show_gift_card_recipient and product.gift_card?
                      assign gift_card_recipient_feature_active = true
                    endif

                    if is_subscription_product == false
                      assign gift_card_recipient_feature_active = false
                    endif

                    assign show_dynamic_checkout = false
                    if block.settings.show_dynamic_checkout and gift_card_recipient_feature_active == false
                      assign show_dynamic_checkout = true
                    endif
                  -%}

                  {%- assign is_subscription_product = product.metafields.custom.subscription_product.value
                    | default: false
                  -%}
                  {%- if is_subscription_product == false -%}
                    {%- assign gift_card_recipient_feature_active = false -%}
                  {%- endif -%}

                  <product-form class="product-form" data-hide-errors="{{ gift_card_recipient_feature_active }}">
                    <div class="product-form__error-message-wrapper" role="alert" hidden>
                      <svg
                        aria-hidden="true"
                        focusable="false"
                        role="presentation"
                        class="icon icon-error"
                        viewBox="0 0 13 13"
                      >
                        <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
                        <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
                        <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
                        <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
                      </svg>
                      <span class="product-form__error-message"></span>
                    </div>
                    {%- form 'product',
                      product,
                      id: product_form_id,
                      class: 'form',
                      novalidate: 'novalidate',
                      data-type: 'add-to-cart-form'
                    -%}
                      <input
                        type="hidden"
                        name="id"
                        value="{{ product.selected_or_first_available_variant.id }}"
                        {% if product.selected_or_first_available_variant.available == false %}
                          disabled
                        {% endif %}
                      >

                      {%- if gift_card_recipient_feature_active and is_subscription_product -%}
                        {%- render 'gift-card-recipient-form', product: product, form: form, section: section -%}
                      {%- endif -%}

                      <div class="custom-variant-box" data-subscription-product="{{ is_subscription_product }}">
                        {% comment %} testing if github update is working {% endcomment %}
                        <div class="variant-container">
                          {% if is_subscription_product and product.selling_plan_groups != empty %}
                            {%- comment -%} âœ… Subscription-enabled UI (guarded) {%- endcomment -%}
                            {% for variant in product.variants %}
                              <div
                                class="variant-card {% if forloop.first %}active{% endif %}"
                                data-variant-id="{{ variant.id }}"
                                data-title="{{ variant.title }}"
                                data-index="{{ forloop.index  }}"
                              >
                                {% assign quantity = variant.title | split: ' ' | last %}

                                <p class="cstm_checkbox"></p>
                                <div class="middle_content">
                                  <div class="variant_title_and_discount">
                                    {% if quantity contains 1 %}
                                      <div class="title">Monthly Delivery</div>
                                    {% else %}
                                      <div class="title">{{ quantity }}-Month Delivery</div>
                                    {% endif %}

                                    {% if variant.metafields.custom.new_style_box_save_text.value != blank %}
                                      <div class="save_val">
                                        {{ variant.metafields.custom.new_style_box_save_text.value }}
                                      </div>
                                    {% endif %}
                                  </div>
                                  <div class="all_common_text">free shipping. pause or cancel anytime.</div>
                                  <div class="sub_text">
                                    {%- assign sp_alloc = variant.selling_plan_allocations | first -%}
                                    {%- if sp_alloc
                                      and sp_alloc.selling_plan
                                      and sp_alloc.selling_plan.price_adjustments
                                      and sp_alloc.selling_plan.price_adjustments.size > 0
                                    -%}
                                      {%- comment -%} Get first payment from price_adjustments[0] (offer discount price) {%- endcomment -%}
                                      {%- assign first_payment = sp_alloc.selling_plan.price_adjustments[0].value -%}
                                      {%- comment -%} Get subsequent payment price from Appstle "change discount to" fixed price {%- endcomment -%}
                                      {%- comment -%} Try multiple approaches to find the price that applies after first payment {%- endcomment -%}
                                      {%- assign subscription_price = null -%}
                                      {%- comment -%} Method 1: Look for price_adjustment with order_count > 1 {%- endcomment -%}
                                      {%- for price_adj in sp_alloc.selling_plan.price_adjustments -%}
                                        {%- if price_adj.order_count != blank and price_adj.order_count > 1 -%}
                                          {%- assign subscription_price = price_adj.value -%}
                                          {%- break -%}
                                        {%- endif -%}
                                      {%- endfor -%}
                                      {%- comment -%} Method 2: If price_adjustments has multiple entries, the second one might be the subsequent price {%- endcomment -%}
                                      {%- if subscription_price == null and sp_alloc.selling_plan.price_adjustments.size > 1 -%}
                                        {%- assign subscription_price = sp_alloc.selling_plan.price_adjustments[1].value -%}
                                      {%- endif -%}
                                      {%- comment -%} Method 3: Try accessing via selling plan group {%- endcomment -%}
                                      {%- if subscription_price == null -%}
                                        {%- for sp_group in product.selling_plan_groups -%}
                                          {%- for sp in sp_group.selling_plans -%}
                                            {%- if sp.id == sp_alloc.selling_plan.id and sp.price_adjustments.size > 1 -%}
                                              {%- assign subscription_price = sp.price_adjustments[1].value -%}
                                              {%- break -%}
                                            {%- endif -%}
                                          {%- endfor -%}
                                          {%- if subscription_price != null -%}
                                            {%- break -%}
                                          {%- endif -%}
                                        {%- endfor -%}
                                      {%- endif -%}
                                      {%- comment -%} Method 4: Check if price_adjustment has a 'price' property instead of 'value' {%- endcomment -%}
                                      {%- if subscription_price == null -%}
                                        {%- for price_adj in sp_alloc.selling_plan.price_adjustments -%}
                                          {%- if price_adj.order_count != blank and price_adj.order_count > 1 and price_adj.price != blank -%}
                                            {%- assign subscription_price = price_adj.price -%}
                                            {%- break -%}
                                          {%- endif -%}
                                        {%- endfor -%}
                                      {%- endif -%}
                                      {%- comment -%} Method 5: Try accessing the selling plan's price directly (might be the subscription price) {%- endcomment -%}
                                      {%- if subscription_price == null and sp_alloc.selling_plan.price != blank -%}
                                        {%- assign subscription_price = sp_alloc.selling_plan.price -%}
                                      {%- endif -%}
                                      {%- comment -%} Method 6: If still null, check if there's a second price_adjustment with different properties {%- endcomment -%}
                                      {%- if subscription_price == null and sp_alloc.selling_plan.price_adjustments.size > 1 -%}
                                        {%- assign second_adj = sp_alloc.selling_plan.price_adjustments[1] -%}
                                        {%- if second_adj.price != blank -%}
                                          {%- assign subscription_price = second_adj.price -%}
                                        {%- elsif second_adj.value != blank -%}
                                          {%- assign subscription_price = second_adj.value -%}
                                        {%- endif -%}
                                      {%- endif -%}
                                      {%- comment -%} Final fallback: Use first_payment (better than variant.price) {%- endcomment -%}
                                      {%- if subscription_price == null -%}
                                        {%- assign subscription_price = first_payment -%}
                                      {%- endif -%}
                                      {%- comment -%} Try multiple ways to get interval_count from Appstle {%- endcomment -%}
                                      {%- assign interval_count = null -%}
                                      {%- comment -%} Try from recurring_deliveries first {%- endcomment -%}
                                      {%- if sp_alloc.selling_plan.recurring_deliveries != blank and sp_alloc.selling_plan.recurring_deliveries.first.interval_count != blank -%}
                                        {%- assign interval_count = sp_alloc.selling_plan.recurring_deliveries.first.interval_count -%}
                                      {%- comment -%} Try from selling_plan directly {%- endcomment -%}
                                      {%- elsif sp_alloc.selling_plan.interval_count != blank -%}
                                        {%- assign interval_count = sp_alloc.selling_plan.interval_count -%}
                                      {%- comment -%} Try from selling plan group {%- endcomment -%}
                                      {%- elsif product.selling_plan_groups.first.selling_plans.first.interval_count != blank -%}
                                        {%- assign interval_count = product.selling_plan_groups.first.selling_plans.first.interval_count -%}
                                      {%- comment -%} Fallback to quantity from variant title {%- endcomment -%}
                                      {%- else -%}
                                        {%- assign interval_count = quantity | plus: 0 -%}
                                      {%- endif -%}
                                      {%- if interval_count == 1 -%}
                                        first payment {{ first_payment | money }}, then {{ subscription_price | money }} every {{ interval_count }} month
                                      {%- else -%}
                                        first payment {{ first_payment | money }}, then {{ subscription_price | money }} every {{ interval_count }} months
                                      {%- endif -%}
                                    {%- else -%}
                                      {% if quantity contains 1 %}
                                        a {{ quantity }}-month supply each month
                                      {% else %}
                                        a {{ quantity }}-month supply delivered every {{ quantity }} months
                                      {% endif %}
                                    {%- endif -%}
                                  </div>
                                </div>
                                <div class="right_price_part">
                                  <div class="pro_prices">
                                    {%- assign sp_alloc = variant.selling_plan_allocations | first -%}
                                    {%- if sp_alloc
                                      and sp_alloc.selling_plan
                                      and sp_alloc.selling_plan.price_adjustments
                                      and sp_alloc.selling_plan.price_adjustments.size > 0
                                    -%}
                                      <div class="discounted_price">
                                        {{ sp_alloc.selling_plan.price_adjustments[0].value | money }}
                                      </div>
                                    {%- else -%}
                                      <div class="discounted_price">{{ variant.price | money }}</div>
                                    {%- endif -%}
                                    <div class="original_price compare_at_price">
                                      {{ variant.compare_at_price | money }}
                                    </div>
                                  </div>
                                </div>
                              </div>
                            {% endfor %}
                          {% else %}
                            {%- comment -%} âœ… One-time-only UI (same classes) {%- endcomment -%}
                            {% for variant in product.variants %}
                              <div
                                class="variant-card {% if variant.id == product.selected_or_first_available_variant.id %}active{% elsif forloop.first %}active{% endif %}"
                                data-variant-id="{{ variant.id }}"
                                data-title="{{ variant.title }}"
                                data-index="{{ forloop.index  }}"
                              >
                                <p class="cstm_checkbox"></p>
                                <div class="middle_content">
                                  <div class="variant_title_and_discount">
                                    <div class="title">One-Time Purchase</div>
                                  </div>

                                  {% if variant.metafields.custom.box_bottom_label.value != blank %}
                                  {% else %}

                                  {% endif %}
                                </div>

                                <div class="right_price_part">
                                  <div class="pro_prices">
                                    <div class="discounted_price">{{ variant.price | money }}</div>
                                    {% if variant.compare_at_price > variant.price %}
                                      <div class="original_price compare_at_price">
                                        {{ variant.compare_at_price | money }}
                                      </div>
                                    {% endif %}
                                  </div>
                                </div>
                              </div>
                            {% endfor %}
                          {% endif %}
                        </div>
                      </div>
                      {% if is_subscription_product %}
                        <div class="free_gift-wrapp">
                          {% if product.metafields.custom.free_gift_headline.value != blank %}
                            <h3>
                              {{ product.metafields.custom.free_gift_headline.value }}
                            </h3>
                          {% endif %}

                          <div class="gift-container">
                            <div class="product-box first_free-ship active">
                              <div class="box-inner">
                                <div class="free-gift-price">
                                  <span class="free-text">FREE</span>
                                  <span>{{ product.metafields.custom.free_shipping_price }}</span>
                                </div>
                                <div class="gift_img_lock">
                                  <div class="gift-lockings">
                                    <img
                                      src="https://cdn.shopify.com/s/files/1/0683/1256/3891/files/7d393e37b6860f872ef9f8b67b2b8e8ed90e4b6a.png?v=1752834903"
                                      alt="lock"
                                    >
                                  </div>
                                  <div
                                    class="product-image image-popup-fit-width"
                                    data-img-src="{{ product.metafields.custom.free_shipping_image  }}"
                                    data-price="<strong>Â£19</strong> Value!"
                                  >
                                    <img
                                      src="{{ product.metafields.custom.free_shipping_image | img_url:'master' }} "
                                      height="auto"
                                      width="auto"
                                    >
                                  </div>
                                </div>
                              </div>

                              <div class="gift-label">{{ product.metafields.custom.free_shipping_text }}</div>
                            </div>

                            {% for gift_product in product.metafields.custom.free_gift_products.value %}
                              {% if gift_product.title %}
                                <div class="product-box " data-id="{{ gift_product.first_available_variant.id }}">
                                  <div class="box-inner">
                                    <div class="free-gift-price">
                                      <span class="free-text">FREE</span>
                                      <span>{{ gift_product.price | money }}</span>
                                    </div>
                                    <div class="gift_img_lock">
                                      <div class="gift-lockings">
                                        <img
                                          src="https://cdn.shopify.com/s/files/1/0683/1256/3891/files/7d393e37b6860f872ef9f8b67b2b8e8ed90e4b6a.png?v=1752834903"
                                          alt="lock"
                                        >
                                      </div>
                                      <div
                                        class="product-image image-popup-fit-width"
                                        data-img-src="{{ gift_product.featured_image | image_url: width: 100 }}"
                                        data-price="<strong>Â£19</strong> Value!"
                                      >
                                        <img
                                          src="{{ gift_product.featured_image | image_url: width: 100 }}"
                                          height="auto"
                                          width="auto"
                                        >
                                      </div>
                                    </div>
                                  </div>
                                  <div class="gift-label">{{ gift_product.title }}</div>
                                </div>
                              {% endif %}
                            {% endfor %}
                          </div>
                        </div>
                      {% endif %}

                      <div class="product-form__buttons" data-protected="true">
                        <div class="product-form__buttons-row">
                          {% if block.settings.show_quantity %}
                            {%- assign cart_qty = cart
                              | item_count_for_variant: product.selected_or_first_available_variant.id
                            -%}
                            <div
                              class="product-parameters__item product-parameters__variant product-parameters__variant--quantity"
                              style="display:none;"
                            >
                              <div
                                id="Quantity-Form-{{ section.id }}"
                                class="product-parameters__item product-parameters__quantity"
                              >
                                <div class="product-form__input product-form__quantity" {{ block.shopify_attributes }}>
                                  <quantity-input class="quantity">
                                    <button class="quantity__button no-js-hidden" name="minus" type="button">
                                      <span class="visually-hidden">
                                        {{-
                                          'products.product.quantity.decrease'
                                          | t: product: product.title
                                          | escape
                                        -}}
                                      </span>
                                      {% render 'icon-minus' %}
                                    </button>
                                    <input
                                      class="quantity__input"
                                      type="number"
                                      name="quantity"
                                      id="Quantity-{{ section.id }}"
                                      data-cart-quantity="{{ cart_qty }}"
                                      min="1"
                                      value="1"
                                      form="{{ product_form_id }}"
                                      aria-label="Quantity"
                                    >
                                    <button class="quantity__button no-js-hidden" name="plus" type="button">
                                      <span class="visually-hidden">
                                        {{-
                                          'products.product.quantity.increase'
                                          | t: product: product.title
                                          | escape
                                        -}}
                                      </span>
                                      {% render 'icon-plus' %}
                                    </button>
                                  </quantity-input>
                                </div>
                              </div>
                            </div>
                          {% endif %}

                          <button
                            id="ProductSubmitButton-{{ section.id }}"
                            type="submit"
                            name="add"
                            class="product-form__submit button {% if block.settings.show_dynamic_checkout and product.selling_plan_groups == empty %}button--secondary{% else %}button--primary{% endif %}"
                            {% if product.selected_or_first_available_variant.available == false %}
                              disabled
                            {% endif %}
                          >
                            {%- if product.selected_or_first_available_variant.available == false -%}
                              <span>
                                {{ 'products.product.sold_out' | t }}
                              </span>
                              {%- render 'icon-loading' -%}
                            {%- else -%}
                              <span> Add to cart </span>
                            {%- endif -%}
                          </button>
                        </div>
                        <div class="product-form__checkout">
                          {%- if show_dynamic_checkout -%}
                            {{ form | payment_button }}
                          {%- endif -%}
                        </div>
                      </div>

                      {% comment %}
                        {% for variant in product.variants %}
                          {% if variant.title contains '1' %}
                            <div class="one_time_puchase buy_once {%unless product.selected_or_first_available_variant.id == variant.id %}hidden{% endunless %}" data-var-id="{{ variant.id }}" data-title="{{ variant.title }}">
                              <a href="#" class="buy-once-link" data-buy-once="true">Buy Once for {{ variant.price | money }} {% if block.settings.buy_once_extra_text != blank %}{{block.settings.buy_once_extra_text}}{% endif %}</a>
                            </div>
                          {% endif %}
                        {% endfor %}
                      {% endcomment %}
                      {% if is_subscription_product %}
                        {% for variant in product.variants %}
                          <div
                            class="one_time_puchase buy_once {% unless product.selected_or_first_available_variant.id == variant.id %}hidden{% endunless %}"
                            data-var-id="{{ variant.id }}"
                            data-title="{{ variant.title }}"
                            style="cursor: pointer;"
                          >
                            <a href="javascript:void(0)" class="buy-once-link" data-buy-once="true"
                              >Buy Once for {{ variant.price | money -}}
                              {%- if block.settings.buy_once_extra_text != blank %}
                                {{ block.settings.buy_once_extra_text -}}
                              {%- endif -%}
                            </a>
                          </div>
                        {% endfor %}

                        <script>
                          (function () {
                            console.log('ðŸš€ Buy Once script starting...');
                            const sectionId = 'MainProduct-{{ section.id }}';
                            console.log('ðŸ” Looking for section with ID:', sectionId);
                            const section = document.getElementById(sectionId);
                            if (!section) {
                              console.error('âŒ Section not found! ID:', sectionId);
                              console.log('Available sections:', document.querySelectorAll('[id^="MainProduct"]'));
                              return;
                            }
                            console.log('âœ… Section found:', section);

                            // Function to update "Buy Once" link visibility based on selected variant
                            function updateBuyOnceVisibility(selectedVariantId) {
                              const buyOnceLinks = section.querySelectorAll('.one_time_puchase.buy_once');
                              buyOnceLinks.forEach((link) => {
                                const linkVariantId = link.getAttribute('data-var-id');
                                if (linkVariantId === String(selectedVariantId)) {
                                  link.classList.remove('hidden');
                                } else {
                                  link.classList.add('hidden');
                                }
                              });
                            }

                            // Get current variant ID from form input (most reliable source)
                            function getCurrentVariantId() {
                              const form = section.querySelector('form[action="/cart/add"]');
                              if (!form) return null;
                              const idInput = form.querySelector('input[name="id"]');
                              return idInput ? idInput.value : null;
                            }

                            // DISABLED: Now handled in global.js with event delegation for all variants
                            // Use event delegation on the section to handle clicks
                            // This works even if links are replaced by other scripts
                            // Use capture phase (true) to intercept BEFORE global.js handlers
                            /*
                            section.addEventListener('click', async function(event) {
                              // Check if click is on a "Buy Once" link or container
                              const clickedLink = event.target.closest('.buy-once-link');
                              const clickedContainer = event.target.closest('.one_time_puchase.buy_once');
                              
                              // Must be clicking on either the link or its container
                              if (!clickedLink && !clickedContainer) {
                                return; // Not a Buy Once click, ignore
                              }
                              
                              // Get the container (either directly clicked or parent of clicked link)
                              const buyOnceContainer = clickedContainer || clickedLink.closest('.one_time_puchase.buy_once');
                              if (!buyOnceContainer) {
                                console.error('âŒ Could not find container for Buy Once click');
                                return;
                              }
                              
                              // Check if container is hidden
                              if (buyOnceContainer.classList.contains('hidden')) {
                                console.warn('âš ï¸ Clicked on hidden container, but processing anyway');
                                // Still process it - the container might be hidden but we want to add the variant
                              }
                              
                              // Prevent default behavior
                              event.preventDefault();
                              event.stopPropagation();
                              event.stopImmediatePropagation();
                              
                              const main_pro_id = buyOnceContainer.getAttribute('data-var-id');
                              const main_pro_title = buyOnceContainer.getAttribute('data-title');
                              
                              console.log('ðŸ–±ï¸ === Buy Once Click Detected ===');
                              console.log('Container:', buyOnceContainer);
                              console.log('Variant ID:', main_pro_id);
                              console.log('Variant title:', main_pro_title);
                              console.log('Is hidden?', buyOnceContainer.classList.contains('hidden'));
                              console.log('Event target:', event.target);
                              debugger; // DEBUG: Verify variant ID is correct

                              if (!main_pro_id) {
                                console.error('Could not determine variant ID for one-time purchase');
                                console.error('Container:', buyOnceContainer);
                                console.error('Container attributes:', {
                                  'data-var-id': buyOnceContainer.getAttribute('data-var-id'),
                                  'data-title': buyOnceContainer.getAttribute('data-title'),
                                  classes: buyOnceContainer.className
                                });
                                return;
                              }

                              console.log('One-time purchase: Adding variant', main_pro_id, 'from container data-var-id');
                              console.log('Variant title:', main_pro_title);

                                // Get quantity from form
                                const form = section.querySelector('form[action="/cart/add"]');
                                const qtyInput = form ? form.querySelector('input[name="quantity"]') : null;
                                const qty = Math.max(1, parseInt(qtyInput ? qtyInput.value : '1', 10) || 1);

                                // CRITICAL: Temporarily uncheck any subscription option in Appstle widget
                                // This prevents Appstle from adding a selling_plan
                                const subs_widget = document.querySelector('.appstle_sub_widget');
                                let checkedSubscriptionInput = null;
                                if (subs_widget) {
                                  // Find and uncheck any checked subscription radio button
                                  checkedSubscriptionInput = subs_widget.querySelector('input[type="radio"]:checked');
                                  if (checkedSubscriptionInput) {
                                    checkedSubscriptionInput.checked = false;
                                    console.log('Unchecked subscription option to ensure one-time purchase');
                                  }
                                  
                                  // Also check the one-time purchase option if it exists
                                  const oneTimeInput = subs_widget.querySelector('.appstle_subscription_wrapper_option:not(.appstle_include_dropdown) input[type="radio"]');
                                  if (oneTimeInput) {
                                    oneTimeInput.checked = true;
                                    console.log('Checked one-time purchase option');
                                  }
                                }

                                // CRITICAL: Remove any hidden selling_plan inputs from the form
                                // Appstle might add these, and they could be included in the request
                                // Reuse the form variable declared above
                                const hiddenSellingPlanInputs = form ? form.querySelectorAll('input[name="selling_plan"], input[name*="selling"], input[type="hidden"][value*="selling"]') : [];
                                hiddenSellingPlanInputs.forEach(input => {
                                  console.log('Found hidden selling_plan input, temporarily disabling:', input);
                                  input.disabled = true;
                                  input.style.display = 'none';
                                });

                                // Build items array matching original global.js approach
                                const new_arr = [];
                                new_arr.push({ id: main_pro_id, quantity: qty });
                                
                                // Get sections for cart drawer update
                                const cartDrawer = document.querySelector('cart-notification') || document.querySelector('cart-drawer');
                                const sections = ['cart-drawer', 'cart-icon-bubble'];
                                
                                // Build payload - CRITICAL: NO selling_plan field
                                const payload = {
                                  items: new_arr,
                                  sections: sections
                                };
                                
                                console.log('ðŸ“¤ Payload (no selling_plan):', payload);
                                debugger; // DEBUG: Check payload before fetch

                                // Use JSON approach matching original global.js
                                fetch('/cart/add.js', {
                                  method: 'POST',
                                  headers: {
                                    'Content-Type': 'application/json',
                                    'X-Requested-With': 'XMLHttpRequest'
                                  },
                                  body: JSON.stringify(payload)
                                })

                                .then(response => {
                                  console.log('ðŸ“¥ Fetch response received, status:', response.status);
                                  debugger; // DEBUG: Check response
                                  if (!response.ok) {
                                    return response.json().then(err => {
                                      console.error('âŒ Cart add error:', err);
                                      throw new Error(err.description || 'cart/add.js failed');
                                    });
                                  }
                                  return response.json();
                                })
                                .then(response => {
                                  console.log('âœ… One-time purchase success:', response);
                                  debugger; // DEBUG: Check success response
                                  
                                  // Verify the result
                                  if (response.items && response.items.length > 0) {
                                    const addedItem = response.items[response.items.length - 1];
                                    console.log('=== VERIFICATION ===');
                                    console.log('Variant ID requested:', main_pro_id);
                                    console.log('Variant ID added:', addedItem.variant_id);
                                    console.log('Full added item:', addedItem);
                                    
                                    if (String(addedItem.variant_id) !== String(main_pro_id)) {
                                      console.error('âŒ Wrong variant ID! Expected:', main_pro_id, 'Got:', addedItem.variant_id);
                                      alert('Warning: Wrong variant added. Expected: ' + main_pro_id + ', Got: ' + addedItem.variant_id);
                                    } else {
                                      console.log('âœ“ Correct variant ID');
                                    }
                                    
                                    if (addedItem.selling_plan) {
                                      console.error('âŒ Item has selling_plan!', addedItem.selling_plan);
                                      alert('Warning: Item was added as subscription. Please check your cart.');
                                    } else {
                                      console.log('âœ“ No selling_plan - one-time purchase confirmed');
                                    }
                                    console.log('===================');
                                  }

                                  // Ensure one-time purchase option is selected in Appstle widget
                                  if (subs_widget) {
                                    const oneTimeInput = subs_widget.querySelector('.appstle_subscription_wrapper_option:not(.appstle_include_dropdown) input[type="radio"]');
                                    if (oneTimeInput) {
                                      oneTimeInput.checked = true;
                                    }
                                  }

                                  // Update cart drawer (matching original)
                                  if (cartDrawer) {
                                    cartDrawer.classList.remove('is-empty');
                                    if (typeof cartDrawer.renderContents === 'function') {
                                      // The response should have sections if we included it in the payload
                                      // If not, we need to fetch it separately
                                      if (response.sections) {
                                        console.log('âœ… Response has sections, rendering cart drawer');
                                        cartDrawer.renderContents(response);
                                      } else {
                                        console.warn('âš ï¸ Response missing sections, fetching separately');
                                        // Fetch cart drawer HTML separately
                                        fetch('/?sections=cart-drawer,cart-icon-bubble')
                                          .then(res => res.text())
                                          .then(html => {
                                            // Parse the HTML response (Shopify returns JSON with sections)
                                            try {
                                              const sectionsData = JSON.parse(html);
                                              const sectionsResponse = {
                                                id: response.id || Date.now(),
                                                sections: sectionsData
                                              };
                                              cartDrawer.renderContents(sectionsResponse);
                                            } catch (e) {
                                              console.error('Failed to parse sections response:', e);
                                              // Fallback: just open the drawer, it will fetch its own content
                                              if (typeof cartDrawer.open === 'function') {
                                                cartDrawer.open();
                                              }
                                            }
                                          })
                                          .catch(err => {
                                            console.error('Failed to fetch sections:', err);
                                            if (typeof cartDrawer.open === 'function') {
                                              cartDrawer.open();
                                            }
                                          });
                                      }
                                    }
                                    if (typeof cartDrawer.open === 'function' && response.sections) {
                                      // Only auto-open if we have sections, otherwise let renderContents handle it
                                      setTimeout(() => cartDrawer.open(), 100);
                                    }
                                  } else {
                                    console.warn('âš ï¸ No cart drawer found, redirecting to cart');
                                    // Fallback: redirect to cart
                                    window.location.href = '/cart';
                                  }
                                })
                                .catch(err => {
                                  console.error('One-time purchase failed:', err);
                                  alert('Failed to add item to cart: ' + err.message);
                                  // Don't redirect on error - let user stay on page
                                })
                                .finally(() => {
                                  // Re-enable hidden inputs
                                  hiddenSellingPlanInputs.forEach(input => {
                                    input.disabled = false;
                                    input.style.display = '';
                                  });
                                  // Re-check subscription if it was unchecked
                                  if (checkedSubscriptionInput) {
                                    checkedSubscriptionInput.checked = true;
                                  }
                                });
                              });
                            }, true); // Use capture phase to intercept before global.js
                            */

                            // Attach handlers to all "Buy Once" links initially
                            console.log('ðŸ” Searching for Buy Once containers in section...');
                            const allBuyOnceContainers = section.querySelectorAll('.one_time_puchase.buy_once');
                            console.log('ðŸ“¦ Found', allBuyOnceContainers.length, 'Buy Once containers');
                            
                            if (allBuyOnceContainers.length === 0) {
                              console.error('âŒ NO Buy Once containers found!');
                              console.log('Section HTML:', section.innerHTML.substring(0, 500));
                              console.log('Searching for any .one_time_puchase:', document.querySelectorAll('.one_time_puchase'));
                            }
                            
                            allBuyOnceContainers.forEach((container, index) => {
                              const variantId = container.getAttribute('data-var-id');
                              const isHidden = container.classList.contains('hidden');
                              console.log(`  Container ${index + 1}: Variant ${variantId}, Hidden: ${isHidden}`);
                              attachBuyOnceHandler(container);
                            });
                            console.log('âœ… Finished attaching handlers to', allBuyOnceContainers.length, 'containers');
                            debugger; // DEBUG: Check initial attachment

                            // Update visibility function
                            function updateBuyOnceVisibility(selectedVariantId) {
                              debugger; // DEBUG: Check if visibility update is called
                              console.log('ðŸ‘ï¸ updateBuyOnceVisibility called for variant:', selectedVariantId);
                              const buyOnceLinks = section.querySelectorAll('.one_time_puchase.buy_once');
                              console.log('  Found', buyOnceLinks.length, 'containers to check');
                              
                              buyOnceLinks.forEach((container, index) => {
                                const linkVariantId = container.getAttribute('data-var-id');
                                const shouldShow = linkVariantId === String(selectedVariantId);
                                console.log(`  Container ${index + 1}: Variant ${linkVariantId}, Should show: ${shouldShow}`);
                                
                                if (shouldShow) {
                                  container.classList.remove('hidden');
                                  console.log('  âœ… Showing container for variant', linkVariantId);
                                  // No need to reattach handler - event delegation handles all clicks
                                } else {
                                  container.classList.add('hidden');
                                  console.log('  âŒ Hiding container for variant', linkVariantId);
                                }
                              });
                              debugger; // DEBUG: Check visibility after update
                            }

                            // Listen for variant changes to update "Buy Once" visibility
                            const form = section.querySelector('form[action="/cart/add"]');
                            if (form) {
                              const idInput = form.querySelector('input[name="id"]');
                              if (idInput) {
                                console.log('ðŸ” Setting up variant change listeners. Initial variant:', idInput.value);
                                
                                // Use MutationObserver to watch for programmatic changes
                                const observer = new MutationObserver((mutations) => {
                                  const currentVariantId = idInput.value;
                                  console.log('ðŸ”„ MutationObserver detected variant change to:', currentVariantId);
                                  if (currentVariantId) {
                                    updateBuyOnceVisibility(currentVariantId);
                                  }
                                });

                                observer.observe(idInput, {
                                  attributes: true,
                                  attributeFilter: ['value'],
                                });

                                // Also listen for input events
                                idInput.addEventListener('change', () => {
                                  console.log('ðŸ”„ Change event detected, variant:', idInput.value);
                                  updateBuyOnceVisibility(idInput.value);
                                });

                                // Initial update
                                console.log('ðŸš€ Initial visibility update for variant:', idInput.value);
                                updateBuyOnceVisibility(idInput.value);
                                
                                // Log summary of all handlers
                                setTimeout(() => {
                                  console.log('ðŸ“Š SUMMARY: All Buy Once containers:');
                                  const allContainers = section.querySelectorAll('.one_time_puchase.buy_once');
                                  allContainers.forEach((container, index) => {
                                    const variantId = container.getAttribute('data-var-id');
                                    const isHidden = container.classList.contains('hidden');
                                    const link = container.querySelector('.buy-once-link');
                                    const hasHandler = link && link.onclick !== null;
                                    console.log(`  ${index + 1}. Variant ${variantId}: Hidden=${isHidden}, HasLink=${!!link}, HasHandler=${hasHandler}`);
                                  });
                                }, 1000);
                              } else {
                                console.error('âŒ Could not find variant ID input');
                              }
                            } else {
                              console.error('âŒ Could not find form');
                            }

                            // Also watch variant card clicks for subscription products
                            const variantCards = section.querySelectorAll('.variant-card');
                            variantCards.forEach((card) => {
                              card.addEventListener('click', () => {
                                const variantId = card.getAttribute('data-variant-id');
                                if (variantId) {
                                  // Update form input
                                  const form = section.querySelector('form[action="/cart/add"]');
                                  if (form) {
                                    const idInput = form.querySelector('input[name="id"]');
                                    if (idInput) {
                                      idInput.value = variantId;
                                      // Trigger change event to update visibility
                                      idInput.dispatchEvent(new Event('change', { bubbles: true }));
                                    }
                                  }
                                }
                              });
                            });
                          })();
                        </script>
                      {% endif %}
                      {% if block.settings.below_extra_text != block %}
                        <div class="below_atc_text">
                          {{ block.settings.below_extra_text }}
                        </div>
                      {% endif %}
                    {%- endform -%}

                    <script>
                      document.addEventListener('DOMContentLoaded', () => {
                        const section = document.getElementById('MainProduct-{{ section.id }}');
                        if (!section) return;

                        const form = section.querySelector('form[action="/cart/add"]');
                        const idInput = form?.querySelector('input[name="id"]');
                        const box = section.querySelector('.custom-variant-box');
                        if (!form || !idInput || !box) return;

                        const cards = Array.from(box.querySelectorAll('.variant-card'));
                        if (!cards.length) return;

                        // Function to update "Buy Once" visibility
                        function updateBuyOnceVisibility(variantId) {
                          const buyOnceLinks = section.querySelectorAll('.one_time_puchase.buy_once');
                          buyOnceLinks.forEach((link) => {
                            const linkVariantId = link.getAttribute('data-var-id');
                            if (linkVariantId === String(variantId)) {
                              link.classList.remove('hidden');
                            } else {
                              link.classList.add('hidden');
                            }
                          });
                        }

                        // Initialize active card
                        let active = cards.find((c) => c.classList.contains('active')) || cards[0];
                        active.classList.add('active');
                        const initialVariantId = active.getAttribute('data-variant-id');
                        idInput.value = initialVariantId;
                        updateBuyOnceVisibility(initialVariantId);

                        // Handle card clicks
                        cards.forEach((card) => {
                          card.addEventListener('click', () => {
                            cards.forEach((c) => c.classList.remove('active'));
                            card.classList.add('active');
                            const variantId = card.getAttribute('data-variant-id');
                            idInput.value = variantId;
                            updateBuyOnceVisibility(variantId);
                            // Trigger change event for other listeners
                            idInput.dispatchEvent(new Event('change', { bubbles: true }));
                          });
                        });
                      });
                    </script>
                  </product-form>
                </div>
              {%- when 'pickup_availability' -%}
                <div {{ block.shopify_attributes }}>
                  {{ 'component-pickup-availability.css' | asset_url | stylesheet_tag }}

                  {%- assign pick_up_availabilities = product.selected_or_first_available_variant.store_availabilities
                    | where: 'pick_up_enabled', true
                  -%}

                  <pickup-availability
                    class="product__pickup-availabilities no-js-hidden"
                    {% if product.selected_or_first_available_variant.available and pick_up_availabilities.size > 0 %}
                      available
                    {% endif %}
                    data-base-url="{{ shop.url }}{{ routes.root_url }}"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    data-has-only-default-variant="{{ product.has_only_default_variant }}"
                  >
                    <template>
                      <pickup-availability-preview class="pickup-availability-preview">
                        {% render 'icon-unavailable' %}
                        <div class="pickup-availability-info">
                          <p class="caption-large">{{ 'products.product.pickup_availability.unavailable' | t }}</p>
                          <button class="pickup-availability-button link link--text underlined-link">
                            {{ 'products.product.pickup_availability.refresh' | t }}
                          </button>
                        </div>
                      </pickup-availability-preview>
                    </template>
                  </pickup-availability>
                  <script src="{{ 'pickup-availability.js' | asset_url }}" defer="defer"></script>
                </div>

              {%- when 'popup' -%}
                <div class="product-popup">
                  <modal-opener
                    class="no-js-hidden"
                    data-modal="#PopupModal-{{ block.id }}"
                    {{ block.shopify_attributes }}
                  >
                    <button
                      id="ProductPopup-{{ block.id }}"
                      class="product-popup__link product-popup__link--info"
                      type="button"
                      aria-haspopup="dialog"
                    >
                      <span>{{ block.settings.label }}</span>
                    </button>
                  </modal-opener>
                  <div class="product-popup-modal__content-info no-js">
                    <h2 class="product-popup-modal__title">
                      {{ block.settings.heading }}
                    </h2>
                    <div class="product-popup-modal__text">
                      {{ block.settings.text }}
                    </div>
                    {%- if block.settings.page.content != blank -%}
                      {{ block.settings.page.content }}
                    {%- endif -%}
                  </div>
                  <modal-dialog
                    id="PopupModal-{{ block.id }}"
                    class="product-popup-modal"
                    {{ block.shopify_attributes }}
                  >
                    <div
                      role="dialog"
                      aria-label="{{ block.settings.label }}"
                      aria-modal="true"
                      class="product-popup-modal__content"
                      tabindex="-1"
                    >
                      <button
                        id="ModalClose-{{ block.id }}"
                        type="button"
                        class="product-popup-modal__toggle modal-close-button"
                        aria-label="{{ 'accessibility.close' | t }}"
                      >
                        {% render 'icon-close' %}
                      </button>
                      <div class="product-popup-modal__content-info">
                        <h2 class="product-popup-modal__title">
                          {{ block.settings.heading }}
                        </h2>
                        <div class="product-popup-modal__text">
                          {{ block.settings.text }}
                        </div>
                        {%- if block.settings.page.content != blank -%}
                          {{ block.settings.page.content }}
                        {%- endif -%}
                      </div>
                    </div>
                  </modal-dialog>
                </div>

              {% when 'buy_with' %}
                <product-recommendations
                  class="product-recommendations product-recommendations--single"
                  data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit=1"
                >
                  {% if recommendations.performed and recommendations.products_count > 0 %}
                    <p class="product-form__group-name product-form__group-name--recommend">
                      {{ 'products.product.buy_with' | t }}
                    </p>
                    {% for recommendation in recommendations.products limit: 3 %}
                      <div class="card-wrapper">
                        {%- liquid
                          assign featured_media_aspect_ratio = recommendation.featured_media.aspect_ratio

                          if recommendation.featured_media.aspect_ratio == null
                            assign featured_media_aspect_ratio = 1
                          endif
                        -%}

                        {% if recommendation.media[1] != null and section.settings.show_secondary_image %}
                          {% assign image_height = recommendation.media[1].width
                            | divided_by: recommendation.media[1].aspect_ratio
                          %}

                          {{
                            recommendation.media[1]
                            | image_url: width: 3840
                            | image_tag:
                              loading: 'lazy',
                              width: recommendation.media[1].width,
                              height: image_height,
                              sizes: '(min-width: 270px) 50vw, 100vw',
                              widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840',
                              class: 'card-wrapper__image motion-reduce'
                          }}
                        {% endif %}
                        <span class="visually-hidden">{{ recommendation.title | escape }}</span>
                        <div class="card card--product" tabindex="-1">
                          <div class="card--product_image">
                            {% if recommendation.featured_media %}
                              {% assign image_height = recommendation.featured_media.width
                                | divided_by: recommendation.featured_media.aspect_ratio
                              %}

                              {{
                                recommendation.featured_media
                                | image_url: width: 3840
                                | image_tag:
                                  loading: 'lazy',
                                  width: recommendation.featured_media.width,
                                  height: image_height,
                                  sizes: '(min-width: 270px) 50vw, 100vw',
                                  widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840',
                                  class: 'motion-reduce'
                              }}
                            {% elsif recommendation.featured_media == blank %}
                              {{ 'product-3' | placeholder_svg_tag: 'placeholder-svg' }}
                            {% endif %}
                          </div>
                        </div>

                        <div class="card-information">
                          <div class="card-information__wrapper">
                            <h3 class="card__title">
                              {{ recommendation.title | escape }}
                            </h3>

                            <div class="card-information__bottom">
                              {% render 'price', product: recommendation, price_class: '' %}
                            </div>
                          </div>
                        </div>
                        <a
                          href="{{ recommendation.url | default: '#' }}"
                          class="link link--overlay card-wrapper__link--overlay"
                        ></a>
                      </div>
                    {% endfor %}
                  {% endif %}
                </product-recommendations>

              {% when 'complementary' %}
                <product-recommendations
                  class="product-recommendations product-recommendations--single"
                  data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit={{ block.settings.product_list_limit }}&intent=complementary"
                >
                  {% if recommendations.performed and recommendations.products_count > 0 %}
                    <p class="product-form__group-name product-form__group-name--recommend">
                      {{ 'products.product.buy_with' | t }}
                    </p>
                    {% for recommendation in recommendations.products limit: 3 %}
                      <div class="card-wrapper">
                        {%- liquid
                          assign featured_media_aspect_ratio = recommendation.featured_media.aspect_ratio

                          if recommendation.featured_media.aspect_ratio == null
                            assign featured_media_aspect_ratio = 1
                          endif
                        -%}

                        {% if recommendation.media[1] != null and section.settings.show_secondary_image %}
                          {% assign image_height = recommendation.media[1].width
                            | divided_by: recommendation.media[1].aspect_ratio
                          %}

                          {{
                            recommendation.media[1]
                            | image_url: width: 3840
                            | image_tag:
                              loading: 'lazy',
                              width: recommendation.media[1].width,
                              height: image_height,
                              sizes: '(min-width: 270px) 50vw, 100vw',
                              widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840',
                              class: 'card-wrapper__image motion-reduce'
                          }}
                        {% endif %}
                        <span class="visually-hidden">{{ recommendation.title | escape }}</span>
                        <div class="card card--product" tabindex="-1">
                          {% if recommendation.featured_media %}
                            {% assign image_height = recommendation.featured_media.width
                              | divided_by: recommendation.featured_media.aspect_ratio
                            %}

                            {{
                              recommendation.featured_media
                              | image_url: width: 3840
                              | image_tag:
                                loading: 'lazy',
                                width: recommendation.featured_media.width,
                                height: image_height,
                                sizes: '(min-width: 270px) 50vw, 100vw',
                                widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840',
                                class: 'motion-reduce'
                            }}
                          {% elsif recommendation.featured_media == blank %}
                            {{ 'product-3' | placeholder_svg_tag: 'placeholder-svg' }}
                          {% endif %}
                        </div>

                        <div class="card-information">
                          <div class="card-information__wrapper">
                            <h3 class="card__title">
                              {{ recommendation.title | escape }}
                            </h3>

                            <div class="card-information__bottom">
                              {% render 'price', product: recommendation, price_class: '' %}
                            </div>
                          </div>
                        </div>
                        <a
                          href="{{ recommendation.url | default: '#' }}"
                          class="link link--overlay card-wrapper__link--overlay"
                        ></a>
                      </div>
                    {% endfor %}
                  {% endif %}
                </product-recommendations>
              {%- when 'custom_liquid' -%}
                <div class="custom-liquid">
                  {{ block.settings.custom_liquid }}
                </div>

              {%- when 'additional_text' -%}
                <div class="additional_text color-{{ block.settings.color_scheme }} background large-font richtext__content">
                  {{ block.settings.text }}
                </div>

              {% when 'vendor' %}
                {% if block.settings.enable_vendor_link %}
                  <a
                    href="{{ product.vendor | url_for_vendor }}"
                    class="unstyled-link caption-with-letter-spacing vendor-link subtitle"
                  >
                    {{ product.vendor }}
                  </a>
                {% else %}
                  <p class="caption-with-letter-spacing subtitle" {{ block.shopify_attributes }}>
                    {{ product.vendor }}
                  </p>
                {%- endif -%}

              {% when 'inventory' %}
                {% assign inventory = section.blocks | where: 'type', 'inventory' %}
                {%- for block in inventory -%}
                  <div class="inventory" {{ block.shopify_attributes }}>
                    <div class="inventory__wrapper">
                      <div class="inventory__content">
                        <div class="inventory__title">
                          <span id="Inventory-{{ section.id }}">
                            <span class="inventory__title--default extra_small-font {% if product.selected_or_first_available_variant.inventory_quantity > 0 and product.selected_or_first_available_variant.inventory_quantity < 10 %}inventory__title--low{% endif %}{% if product.selected_or_first_available_variant.inventory_quantity >= 10 %}inventory__title--instock{% endif %}">
                              {% if product.selected_or_first_available_variant.inventory_quantity > 0 %}
                                {% if product.selected_or_first_available_variant.inventory_quantity < 10 %}
                                  {%- render 'icon-stock-low' -%}
                                {% else %}
                                  {%- render 'icon-stock-instock' -%}
                                {% endif %}

                                {{
                                  'products.product.quantity.in_stock'
                                  | t: quantity: product.selected_or_first_available_variant.inventory_quantity
                                }}
                              {% else %}
                                {%- render 'icon-stock-default' -%}
                                {{ 'products.product.quantity.out_of_stock' | t }}
                              {% endif %}
                            </span>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endfor %}

              {%- when 'icon-with-text' -%}
                {% render 'icon-with-text', block: block %}

              {%- when 'sku' -%}
                <p
                  class="product__sku subtitle no-js-hidden {% if product.selected_or_first_available_variant.sku.size == 0 %} visibility-hidden{% endif %}"
                  id="Sku-{{ section.id }}"
                  role="status"
                  {{ block.shopify_attributes }}
                >
                  <span class="visually-hidden">{{ 'products.product.sku' | t }}:</span>
                  {{- product.selected_or_first_available_variant.sku -}}
                </p>

              {%- when 'grid_video_image_slider' -%}
                <div class="grid_video_image_slider third-slider-images-video {% if block.settings.show_undermedia %}hidethis_block_dekstop_under_pro_content{% else %}block_under_main_pro_content{% endif %}">
                  {% render 'grid_video_image_slider', block: block %}
                  <script>
                    document.addEventListener('DOMContentLoaded', function () {
                      new Swiper('.third-slider-images-video .results-slider-container .swiper', {
                        loop: true,
                        navigation: {
                          nextEl: '.third-slider-images-video .custom-nav-btn',
                          prevEl: '.third-slider-images-video .custom-nav-btn',
                        },
                        scrollbar: {
                          el: '.third-slider-images-video .swiper-scrollbar',
                        },
                        slidesPerView: 1,
                        spaceBetween: 20,
                      });
                    });
                  </script>
                </div>

              {%- when 'double_media' -%}
                {%- liquid
                  assign desktop_image_1 = block.settings.image
                  assign mobile_image_1 = block.settings.mobile_image
                  assign desktop_image_2 = block.settings.image1
                  assign mobile_image_2 = block.settings.mobile_image1
                  assign show_undermedia = block.settings.show_undermedia
                -%}
                {%- if desktop_image_1 != blank
                  or mobile_image_1 != blank
                  or desktop_image_2 != blank
                  or mobile_image_2 != blank
                -%}
                  <div
                    class="double_media_wrapper {% if block.settings.show_undermedia %}hidethis_block_dekstop_under_pro_content{% else %}block_under_main_pro_content{% endif %}"
                    {{ block.shopify_attributes }}
                  >
                    <div class="double_media">
                      {% comment %} --- Image 1 (Left on Desktop / Top on Mobile) --- {% endcomment %}
                      {% if desktop_image_1 != blank or mobile_image_1 != blank %}
                        <div class="media-item media-item-1">
                          {% comment %} Determine the source URLs and fallbacks {% endcomment %}
                          {% assign image_1_src = desktop_image_1 | image_url: width: 1200 %}
                          {% assign image_1_alt = desktop_image_1.alt | default: 'Image 1' | escape %}

                          {% if mobile_image_1 != blank %}
                            {% assign mobile_1_src = mobile_image_1 | image_url: width: 800 %}
                          {% else %}
                            {% comment %} Fallback: use the desktop image if mobile image is not set {% endcomment %}
                            {% assign mobile_1_src = image_1_src %}
                          {% endif %}

                          <picture>
                            {% comment %} Source for small screens (max-width: 749px) {% endcomment %}
                            <source
                              media="(max-width: 749px)"
                              srcset="{{ mobile_1_src }}"
                            >
                            {% comment %} Default source for large screens (desktop image) {% endcomment %}
                            <img
                              src="{{ image_1_src }}"
                              width="{{ desktop_image_1.width | default: 800 }}"
                              height="{{ desktop_image_1.height | default: 800 }}"
                              alt="{{ image_1_alt }}"
                              loading="lazy"
                            >
                          </picture>
                        </div>
                      {% endif %}

                      {% comment %} --- Image 2 (Right on Desktop / Bottom on Mobile) --- {% endcomment %}
                      {% if desktop_image_2 != blank or mobile_image_2 != blank %}
                        <div class="media-item media-item-2">
                          {% comment %} Determine the source URLs and fallbacks {% endcomment %}
                          {% assign image_2_src = desktop_image_2 | image_url: width: 1200 %}
                          {% assign image_2_alt = desktop_image_2.alt | default: 'Image 2' | escape %}

                          {% if mobile_image_2 != blank %}
                            {% assign mobile_2_src = mobile_image_2 | image_url: width: 800 %}
                          {% else %}
                            {% comment %} Fallback: use the desktop image if mobile image is not set {% endcomment %}
                            {% assign mobile_2_src = image_2_src %}
                          {% endif %}

                          <picture>
                            {% comment %} Source for small screens (max-width: 749px) {% endcomment %}
                            <source
                              media="(max-width: 749px)"
                              srcset="{{ mobile_2_src }}"
                            >
                            {% comment %} Default source for large screens (desktop image) {% endcomment %}
                            <img
                              src="{{ image_2_src }}"
                              width="{{ desktop_image_2.width | default: 800 }}"
                              height="{{ desktop_image_2.height | default: 800 }}"
                              alt="{{ image_2_alt }}"
                              loading="lazy"
                            >
                          </picture>
                        </div>
                      {% endif %}
                    </div>
                  </div>
                  <style>
                    /* Desktop: Two columns */
                    .double_media {
                      display: grid;
                      grid-template-columns: 1fr 1fr;
                      gap: 20px; /* Adjust gap as needed */
                      width: 100%;
                    }

                    /* Ensure images fill their container */
                    .double_media img {
                      display: block;
                      width: 100%;
                      height: auto;
                    }

                    /* Mobile: Stacked view */
                    @media screen and (max-width: 749px) {
                      .double_media {
                        grid-template-columns: 1fr; /* Stack images vertically */
                        gap: 15px;
                      }
                    }
                  </style>
                {%- endif -%}

              {%- when 'single_media' -%}
                {%- liquid
                  assign desktop_image = block.settings.image
                  if block.settings.mobile_image != blank
                    assign mobile_image = block.settings.mobile_image
                  else
                    assign mobile_image = block.settings.image
                  endif
                  assign show_undermedia = block.settings.show_undermedia
                -%}

                {%- if desktop_image != blank or mobile_image != blank -%}
                  <div
                    class="single_media {% if block.settings.show_undermedia %}hidethis_block_dekstop_under_pro_content{% else %}block_under_main_pro_content{% endif %}"
                    {{ block.shopify_attributes }}
                  >
                    {% if desktop_image != blank %}
                      <img
                        src="{{ desktop_image | image_url: width: 1200 }}"
                        width="{{ desktop_image.width }}"
                        height="{{ desktop_image.height }}"
                        alt="{{ desktop_image.alt | escape }}"
                        loading="lazy"
                        class="single-media-desktop"
                      >
                    {% endif %}

                    {% if mobile_image != blank %}
                      <img
                        src="{{ mobile_image | image_url: width: 800 }}"
                        width="{{ mobile_image.width }}"
                        height="{{ mobile_image.height }}"
                        alt="{{ mobile_image.alt | escape }}"
                        loading="lazy"
                        class="single-media-mobile"
                      >
                    {% endif %}

                    <style>
                      @media screen and (max-width: 749px) {
                        .single_media .single-media-desktop {
                          display: none !important;
                        }
                        .single_media .single-media-mobile {
                          display: block !important;
                        }
                      }
                      .single_media .single-media-desktop {
                        display: block;
                        width: 100%;
                        height: auto;
                      }
                      .single_media .single-media-mobile {
                        display: none;
                        width: 100%;
                        height: auto;
                      }
                    </style>
                  </div>
                {%- endif -%}

              {%- when 'before_after' -%}
                {% if block.settings.image != blank or block.settings.image1 != blank %}
                  <div class="before_after {% if block.settings.show_undermedia %}hidethis_block_dekstop_under_pro_content{% else %}block_under_main_pro_content{% endif %}">
                    {% if block.settings.image != blank %}
                      <div class="before-after-media-wrep">
                        <img
                          src="{{ block.settings.image | image_url:width:'800px' }}"
                          width=""
                          height=""
                          alt="{{ block.settings.image.alt }}"
                          loading="lazy"
                        >
                        <p>{{ block.settings.text }}</p>
                      </div>
                    {% endif %}
                    {% if block.settings.image1 != blank %}
                      <div class="before-after-media-wrep">
                        <img
                          src="{{ block.settings.image1 | image_url:width:'800px' }}"
                          width=""
                          height=""
                          alt="{{ block.settings.image1.alt }}"
                          loading="lazy"
                        >
                        <p>{{ block.settings.text1 }}</p>
                      </div>
                    {% endif %}
                  </div>
                {% endif %}
            {%- endcase -%}
          {%- endfor -%}
          <div class="mobile-below-gallery-contents">
            {%- for block in section.blocks -%}
              {%- case block.type -%}
                {%- when 'grid_video_image_slider' -%}
                  {% if block.settings.show_undermedia %}
                    <div class="grid_video_image_slider kkkkkkkk {% unless block.settings.show_undermedia %}blocks_undermedia{% endunless %}">
                      {% render 'grid_video_image_slider', block: block %}
                      <script>
                        document.addEventListener('DOMContentLoaded', function () {
                          new Swiper('.grid_video_image_slider.kkkkkkkk .results-slider-container .swiper', {
                            loop: true,
                            navigation: {
                              nextEl: '.grid_video_image_slider.kkkkkkkk .custom-nav-btn',
                              prevEl: '.grid_video_image_slider.kkkkkkkk .custom-nav-btn',
                            },
                            scrollbar: {
                              el: '.grid_video_image_slider.kkkkkkkk .swiper-scrollbar',
                            },
                            slidesPerView: 1,
                            spaceBetween: 20,
                          });
                        });
                      </script>
                    </div>
                  {% endif %}

                {%- when 'double_media' -%}
                  {% if block.settings.show_undermedia %}
                    {%- liquid
                      assign desktop_image_1 = block.settings.image
                      assign mobile_image_1 = block.settings.mobile_image
                      assign desktop_image_2 = block.settings.image1
                      assign mobile_image_2 = block.settings.mobile_image1
                      assign show_undermedia = block.settings.show_undermedia
                    -%}
                    {%- if desktop_image_1 != blank
                      or mobile_image_1 != blank
                      or desktop_image_2 != blank
                      or mobile_image_2 != blank
                    -%}
                      <div
                        class="double_media_wrapper {% unless block.settings.show_undermedia %}blocks_undermedia{% endunless %}"
                        {{ block.shopify_attributes }}
                      >
                        <div class="double_media">
                          {% comment %} --- Image 1 (Left on Desktop / Top on Mobile) --- {% endcomment %}
                          {% if desktop_image_1 != blank or mobile_image_1 != blank %}
                            <div class="media-item media-item-1">
                              {% comment %} Determine the source URLs and fallbacks {% endcomment %}
                              {% assign image_1_src = desktop_image_1 | image_url: width: 1200 %}
                              {% assign image_1_alt = desktop_image_1.alt | default: 'Image 1' | escape %}

                              {% if mobile_image_1 != blank %}
                                {% assign mobile_1_src = mobile_image_1 | image_url: width: 800 %}
                              {% else %}
                                {% comment %} Fallback: use the desktop image if mobile image is not set {% endcomment %}
                                {% assign mobile_1_src = image_1_src %}
                              {% endif %}

                              <picture>
                                {% comment %} Source for small screens (max-width: 749px) {% endcomment %}
                                <source
                                  media="(max-width: 749px)"
                                  srcset="{{ mobile_1_src }}"
                                >
                                {% comment %} Default source for large screens (desktop image) {% endcomment %}
                                <img
                                  src="{{ image_1_src }}"
                                  width="{{ desktop_image_1.width | default: 800 }}"
                                  height="{{ desktop_image_1.height | default: 800 }}"
                                  alt="{{ image_1_alt }}"
                                  loading="lazy"
                                >
                              </picture>
                            </div>
                          {% endif %}

                          {% comment %} --- Image 2 (Right on Desktop / Bottom on Mobile) --- {% endcomment %}
                          {% if desktop_image_2 != blank or mobile_image_2 != blank %}
                            <div class="media-item media-item-2">
                              {% comment %} Determine the source URLs and fallbacks {% endcomment %}
                              {% assign image_2_src = desktop_image_2 | image_url: width: 1200 %}
                              {% assign image_2_alt = desktop_image_2.alt | default: 'Image 2' | escape %}

                              {% if mobile_image_2 != blank %}
                                {% assign mobile_2_src = mobile_image_2 | image_url: width: 800 %}
                              {% else %}
                                {% comment %} Fallback: use the desktop image if mobile image is not set {% endcomment %}
                                {% assign mobile_2_src = image_2_src %}
                              {% endif %}

                              <picture>
                                {% comment %} Source for small screens (max-width: 749px) {% endcomment %}
                                <source
                                  media="(max-width: 749px)"
                                  srcset="{{ mobile_2_src }}"
                                >
                                {% comment %} Default source for large screens (desktop image) {% endcomment %}
                                <img
                                  src="{{ image_2_src }}"
                                  width="{{ desktop_image_2.width | default: 800 }}"
                                  height="{{ desktop_image_2.height | default: 800 }}"
                                  alt="{{ image_2_alt }}"
                                  loading="lazy"
                                >
                              </picture>
                            </div>
                          {% endif %}
                        </div>
                      </div>
                      <style>
                        /* Desktop: Two columns */
                        .double_media {
                          display: grid;
                          grid-template-columns: 1fr 1fr;
                          gap: 20px; /* Adjust gap as needed */
                          width: 100%;
                        }

                        /* Ensure images fill their container */
                        .double_media img {
                          display: block;
                          width: 100%;
                          height: auto;
                        }

                        /* Mobile: Stacked view */
                        @media screen and (max-width: 749px) {
                          .double_media {
                            grid-template-columns: 1fr; /* Stack images vertically */
                            gap: 15px;
                          }
                        }
                      </style>
                    {%- endif -%}
                  {% endif %}

                {%- when 'single_media' -%}
                  {% if block.settings.show_undermedia %}
                    {%- liquid
                      assign desktop_image = block.settings.image
                      if block.settings.mobile_image != blank
                        assign mobile_image = block.settings.mobile_image
                      else
                        assign mobile_image = block.settings.image
                      endif
                      assign show_undermedia = block.settings.show_undermedia
                    -%}

                    {%- if desktop_image != blank or mobile_image != blank -%}
                      <div
                        class="single_media {% unless block.settings.show_undermedia %}blocks_undermedia{% endunless %}"
                        {{ block.shopify_attributes }}
                      >
                        {% if desktop_image != blank %}
                          <img
                            src="{{ desktop_image | image_url: width: 1200 }}"
                            width="{{ desktop_image.width }}"
                            height="{{ desktop_image.height }}"
                            alt="{{ desktop_image.alt | escape }}"
                            loading="lazy"
                            class="single-media-desktop"
                          >
                        {% endif %}

                        {% if mobile_image != blank %}
                          <img
                            src="{{ mobile_image | image_url: width: 800 }}"
                            width="{{ mobile_image.width }}"
                            height="{{ mobile_image.height }}"
                            alt="{{ mobile_image.alt | escape }}"
                            loading="lazy"
                            class="single-media-mobile"
                          >
                        {% endif %}

                        <style>
                          @media screen and (max-width: 749px) {
                            .single_media .single-media-desktop {
                              display: none !important;
                            }
                            .single_media .single-media-mobile {
                              display: block !important;
                            }
                          }
                          .single_media .single-media-desktop {
                            display: block;
                            width: 100%;
                            height: auto;
                          }
                          .single_media .single-media-mobile {
                            display: none;
                            width: 100%;
                            height: auto;
                          }
                        </style>
                      </div>
                    {%- endif -%}
                  {% endif %}

                {%- when 'before_after' -%}
                  {% if block.settings.show_undermedia %}
                    {% if block.settings.image != blank or block.settings.image1 != blank %}
                      <div class="before_after {% unless block.settings.show_undermedia %}blocks_undermedia{% endunless %}">
                        {% if block.settings.image != blank %}
                          <div class="before-after-media-wrep">
                            <img
                              src="{{ block.settings.image | image_url:width:'800px' }}"
                              width=""
                              height=""
                              alt="{{ block.settings.image.alt }}"
                              loading="lazy"
                            >
                            <p>{{ block.settings.text }}</p>
                          </div>
                        {% endif %}
                        {% if block.settings.image1 != blank %}
                          <div class="before-after-media-wrep">
                            <img
                              src="{{ block.settings.image1 | image_url:width:'800px' }}"
                              width=""
                              height=""
                              alt="{{ block.settings.image1.alt }}"
                              loading="lazy"
                            >
                            <p>{{ block.settings.text1 }}</p>
                          </div>
                        {% endif %}
                      </div>
                    {% endif %}
                  {% endif %}
              {% endcase %}
            {% endfor %}
          </div>
        </div>
      </div>
      {% if product.media.size > 0 %}
        <div class="product__media-wrapper {% if section.settings.image_gallery_collage == "thumbnail" %}product__media-thumbnail slider-pagiantion-bullet{% endif %}{% if section.settings.image_gallery_collage == "stacked" %}product__media-wrapper-stacked{% endif %}">
          {% if section.settings.image_gallery_collage == 'thumbnail_carousel'
            or section.settings.image_gallery_collage == 'thumbnail'
          %}
            <div class="product__media-list-wrapper">
              <div class="product__media-sublist js-media-sublist no-js-hidden swiper">
                <div class="swiper-wrapper">
                  {%- if product.selected_or_first_available_variant.featured_media != null -%}
                    {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
                  {%- endif -%}

                  {%- for media in product.media -%}
                    {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
                      <div
                        class="product__media-subitem swiper-slide {% if variant_images contains media.src %} product__media-item--variant{% endif %} {% if section.settings.image_fit == 'contain' %} product__media-item--contain{% endif %}"
                        data-media-sub-id="{{ section.id }}-{{ media.id }}"
                      >
                        <div class="product__media">
                          {% assign image_height = media.preview_image.width
                            | divided_by: media.preview_image.aspect_ratio
                          %}

                          {{
                            media.preview_image
                            | image_url: width: 3840
                            | image_tag:
                              loading: 'lazy',
                              width: media.preview_image.width,
                              height: image_height,
                              sizes: '100vw',
                              widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840'
                          }}
                        </div>
                      </div>
                    {%- endunless -%}
                  {%- endfor -%}
                </div>
              </div>

              <ul class="product__media-sublist no-js ">
                {%- if product.selected_or_first_available_variant.featured_media != null -%}
                  {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
                  <li
                    class="product__media-subitem slider__slide {% if section.settings.image_fit == 'contain' %} product__media-item--contain{% endif %}"
                    data-media-sub-id="{{ section.id }}-{{ featured_media.id }}"
                  >
                    <div class="product__media">
                      {% assign image_height = featured_media.preview_image.width
                        | divided_by: featured_media.preview_image.aspect_ratio
                      %}

                      {{
                        featured_media.preview_image
                        | image_url: width: 3840
                        | image_tag:
                          loading: 'lazy',
                          width: featured_media.preview_image.width,
                          height: image_height,
                          sizes: '100vw',
                          widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840'
                      }}
                    </div>
                  </li>
                {%- endif -%}

                {%- for media in product.media -%}
                  {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
                    <li
                      class="product__media-subitem slider__slide {% if variant_images contains media.src %} product__media-item--variant{% endif %} {% if section.settings.image_fit == 'contain' %} product__media-item--contain{% endif %}"
                      data-media-sub-id="{{ section.id }}-{{ media.id }}"
                    >
                      <div class="product__media">
                        {% assign image_height = media.preview_image.width
                          | divided_by: media.preview_image.aspect_ratio
                        %}

                        {{
                          media.preview_image
                          | image_url: width: 3840
                          | image_tag:
                            loading: 'lazy',
                            width: media.preview_image.width,
                            height: image_height,
                            sizes: '100vw',
                            widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840'
                        }}
                      </div>
                    </li>
                  {%- endunless -%}
                {%- endfor -%}
              </ul>

              <div class="product__media-list">
                <div class="js-media-list no-js-hidden swiper product__media-list--{% if section.settings.enable_autoheight %}auto-enabled{% endif %}">
                  <div class="swiper-wrapper">
                    {%- liquid
                      assign variant_images = product.images | where: 'attached_to_variant?', true | map: 'src'
                      assign media_count = product.media.size
                    -%}

                    {%- if product.selected_or_first_available_variant.featured_media != null -%}
                      {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
                      <div
                        class="product__media-item swiper-slide {% if section.settings.image_fit == 'contain' %} product__media-item--contain{% endif %}"
                        data-media-id="{{ section.id }}-{{ featured_media.id }}"
                      >
                        {% render 'product-thumbnail',
                          product_card_product: product,
                          media: featured_media,
                          position: 'featured',
                          modal_id: section.id,
                          lazy_load: false
                        %}
                      </div>
                    {%- endif -%}

                    {%- for media in product.media -%}
                      {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
                        <div
                          class="product__media-item swiper-slide{% if media.media_type != 'image' %} product__media-item--full{% endif %} {% if variant_images contains media.src %} product__media-item--variant{% endif %} {% if section.settings.image_fit == 'contain' %} product__media-item--contain{% endif %}"
                          data-media-id="{{ section.id }}-{{ media.id }}"
                        >
                          {% render 'product-thumbnail',
                            media: media,
                            position: forloop.index,
                            modal_id: section.id,
                            lazy_load: false
                          %}
                        </div>
                      {%- endunless -%}
                    {%- endfor -%}
                  </div>

                  {% if section.settings.image_gallery_collage == 'thumbnail' %}
                    <div class="swiper-pagination__wrapper">
                      <div class="swiper-pagination swiper-pagination__button background color-background-4"></div>
                    </div>
                  {% endif %}

                  {% if product.media.size > 1 %}
                    <div class="swiper-btn swiper-btn--prev">
                      <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.21932 6.66688L6.79532 10.2429L5.85265 11.1855L0.667319 6.00021L5.85265 0.81488L6.79532 1.75755L3.21932 5.33355L11.334 5.33355L11.334 6.66688L3.21932 6.66688Z" fill="currentColor"/>
                      </svg>
                    </div>
                    <div class="swiper-btn swiper-btn--next">
                      <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8.78068 5.33312L5.20468 1.75712L6.14735 0.814454L11.3327 5.99979L6.14735 11.1851L5.20468 10.2425L8.78068 6.66645L0.666015 6.66645L0.666015 5.33312L8.78068 5.33312Z" fill="currentColor"/>
                      </svg>
                    </div>
                  {% endif %}
                </div>
                {% if settings.show_breadcrumbs %}
                  <nav class="breadcrumb breadcrumb__desktop" role="navigation" aria-label="breadcrumbs">
                    <a
                      href="{{ routes.root_url }}"
                      title="{{ 'general.breadcrumbs.home' | t }}"
                      class="breadcrumb__link"
                    >
                      {{- 'general.breadcrumbs.home' | t -}}
                    </a>
                    <div class="breadcrumb__delimiter">{% render 'icon-breadcrumbs' %}</div>
                    {% if product.collections[0] %}
                      <a href="{{ product.collections[0].url }}" class="breadcrumb__link">
                        {{- product.collections[0].title }}
                      </a>
                      <div class="breadcrumb__delimiter">{% render 'icon-breadcrumbs' %}</div>
                    {% endif %}
                    <span>{{ product.title }}</span>
                  </nav>
                {% endif %}
              </div>

              {% comment %} blocks under media{% endcomment %}
              {% for block in section.blocks %}
                {% case block.type %}
                  {%- when 'single_media' -%}
                    {% if block.settings.show_undermedia %}
                      {% if block.settings.image != blank or block.settings.image1 != blank %}
                        <div class="single_media {% if block.settings.show_undermedia %}hide_blocks_undermedia_desktop{% endif %}">
                          {% if block.settings.image != blank %}
                            <img
                              src="{{ block.settings.image | image_url:width:'800px' }}"
                              width=""
                              height=""
                              alt="{{ block.settings.image.alt }}"
                              loading="lazy"
                            >
                          {% endif %}
                          {% if block.settings.image1 != blank %}
                            <img
                              src="{{ block.settings.image1 | image_url:width:'800px' }}"
                              width=""
                              height=""
                              alt="{{ block.settings.image1.alt }}"
                              loading="lazy"
                            >
                          {% endif %}
                        </div>
                      {% endif %}
                    {% endif %}
                  {%- when 'grid_video_image_slider' -%}
                    {% if block.settings.show_undermedia %}
                      <div class="grid_video_image_slider second {% if block.settings.show_undermedia %}hide_blocks_undermedia_desktop{% endif %}">
                        {% render 'grid_video_image_slider', block: block %}
                        <script>
                          document.addEventListener('DOMContentLoaded', function () {
                            new Swiper('.grid_video_image_slider.second .results-slider-container .swiper', {
                              loop: true,
                              navigation: {
                                nextEl: '.grid_video_image_slider.second .custom-nav-btn',
                                prevEl: '.grid_video_image_slider.second .custom-nav-btn',
                              },
                              scrollbar: {
                                el: '.grid_video_image_slider.second .swiper-scrollbar',
                              },
                              slidesPerView: 1,
                              spaceBetween: 20,
                            });
                          });
                        </script>
                      </div>
                    {% endif %}

                  {%- when 'double_media' -%}
                    {% if block.settings.show_undermedia %}
                      {% if block.settings.image != blank or block.settings.image1 != blank %}
                        <div class="double_media {% if block.settings.show_undermedia %}hide_blocks_undermedia_desktop{% endif %}">
                          {% if block.settings.image != blank %}
                            <img
                              src="{{ block.settings.image | image_url:width:'800px' }}"
                              width=""
                              height=""
                              alt="{{ block.settings.image.alt }}"
                              loading="lazy"
                            >
                          {% endif %}
                          {% if block.settings.image1 != blank %}
                            <img
                              src="{{ block.settings.image1 | image_url:width:'800px' }}"
                              width=""
                              height=""
                              alt="{{ block.settings.image1.alt }}"
                              loading="lazy"
                            >
                          {% endif %}
                        </div>
                      {% endif %}
                    {% endif %}

                  {%- when 'before_after' -%}
                    {% if block.settings.show_undermedia %}
                      {% if block.settings.image != blank or block.settings.image1 != blank %}
                        <div class="before_after {% if block.settings.show_undermedia %}hide_blocks_undermedia_desktop{% endif %}">
                          {% if block.settings.image != blank %}
                            <div class="before-after-media-wrep">
                              <img
                                src="{{ block.settings.image | image_url:width:'800px' }}"
                                width=""
                                height=""
                                alt="{{ block.settings.image.alt }}"
                                loading="lazy"
                              >
                              <p>{{ block.settings.text }}</p>
                            </div>
                          {% endif %}
                          {% if block.settings.image1 != blank %}
                            <div class="before-after-media-wrep">
                              <img
                                src="{{ block.settings.image1 | image_url:width:'800px' }}"
                                width=""
                                height=""
                                alt="{{ block.settings.image1.alt }}"
                                loading="lazy"
                              >
                              <p>{{ block.settings.text1 }}</p>
                            </div>
                          {% endif %}
                        </div>
                      {% endif %}
                    {% endif %}
                {% endcase %}
              {% endfor %}
              {% comment %} blocks under media end end end{% endcomment %}
            </div>

          {% else %}
            <div class="{% if section.settings.image_gallery_collage == "stacked" %}product__media-list__container--large{% if product.media.size == 1 %} product__media-list__container--large-one{% endif %}{% endif %}">
              {% liquid
                assign variant_images = product.images | where: 'attached_to_variant?', true | map: 'src'
                assign media_count = product.media.size
              %}

              {% if product.selected_or_first_available_variant.featured_media != null %}
                {% assign featured_media = product.selected_or_first_available_variant.featured_media %}
                <div
                  class="product__media-item {% if section.settings.image_fit == 'contain' %} product__media-item--contain{% endif %}"
                  data-media-id="{{ section.id }}-{{ featured_media.id }}"
                >
                  {% render 'product-thumbnail',
                    product_card_product: product,
                    media: featured_media,
                    position: 'featured',
                    modal_id: section.id,
                    lazy_load: false
                  %}
                </div>
              {% endif %}

              {% for media in product.media %}
                {% unless media.id == product.selected_or_first_available_variant.featured_media.id %}
                  <div
                    class="product__media-item {% if media.media_type != 'image' %} product__media-item--full{% endif %} {% if variant_images contains media.src %} product__media-item--variant{% endif %} {% if section.settings.image_fit == 'contain' %} product__media-item--contain{% endif %}"
                    data-media-id="{{ section.id }}-{{ media.id }}"
                  >
                    {% render 'product-thumbnail',
                      media: media,
                      position: forloop.index,
                      modal_id: section.id,
                      lazy_load: false
                    %}
                  </div>
                {% endunless %}
              {% endfor %}
            </div>
            {% if settings.show_breadcrumbs %}
              <nav class="breadcrumb breadcrumb__desktop" role="navigation" aria-label="breadcrumbs">
                <a href="{{ routes.root_url }}" title="{{ 'general.breadcrumbs.home' | t }}" class="breadcrumb__link">
                  {{- 'general.breadcrumbs.home' | t -}}
                </a>
                <div class="breadcrumb__delimiter">{% render 'icon-breadcrumbs' %}</div>
                {% if product.collections[0] %}
                  <a href="{{ product.collections[0].url }}" class="breadcrumb__link">
                    {{- product.collections[0].title }}
                  </a>
                  <div class="breadcrumb__delimiter">{% render 'icon-breadcrumbs' %}</div>
                {% endif %}
                <span>{{ product.title }}</span>
              </nav>
            {% endif %}
          {% endif %}

          {%- if first_3d_model -%}
            <button
              class="button button--full-width product__xr-button"
              type="button"
              aria-label="{{ 'products.product.xr_button_label' | t }}"
              data-shopify-xr
              data-shopify-model3d-id="{{ first_3d_model.id }}"
              data-shopify-title="{{ product.title | escape }}"
              data-shopify-xr-hidden
            >
              {% render 'icon-3d-model' %}
              {{ 'products.product.xr_button' | t }}
            </button>
          {%- endif -%}
        </div>
      {% endif %}
    </div>
  </div>

  {%- for block in section.blocks -%}
    {% if block.type == 'modals' %}
      {% if block.settings.modal_label_1 != blank %}
        <div id="ProductModalInfo-{{ section.id }}-1" class="product-info-modal">
          <div class="product-info-modal__scroll">
            <div class="product-info-modal__content">
              <div class="h4 product-info-modal__title">{{ block.settings.modal_heading_1 }}</div>
              <div class="product-info-modal__text">{{ block.settings.modal_text_1 }}</div>
            </div>
          </div>
        </div>
      {% endif %}

      {% if block.settings.modal_label_2 != blank %}
        <div id="ProductModalInfo-{{ section.id }}-2" class="product-info-modal">
          <div class="product-info-modal__scroll">
            <div class="product-info-modal__content">
              <div class="h4 product-info-modal__title">{{ block.settings.modal_heading_2 }}</div>
              <div class="product-info-modal__text">{{ block.settings.modal_text_2 }}</div>
            </div>
          </div>
        </div>
      {% endif %}
    {% endif %}
  {%- endfor -%}

  <product-modal id="ProductModal-{{ section.id }}" class="product-media-modal">
    <div
      class="product-media-modal__dialog"
      role="dialog"
      aria-label="{{ 'products.modal.label' | t }}"
      aria-modal="true"
      tabindex="-1"
    >
      <button
        id="ModalClose-{{ section.id }}"
        type="button"
        class="product-media-modal__toggle modal-close-button"
        aria-label="{{ 'accessibility.close' | t }}"
      >
        {% render 'icon-close' %}
      </button>

      <div
        class="product-media-modal__content"
        role="document"
        aria-label="{{ 'products.modal.label' | t }}"
        tabindex="0"
      >
        {%- for media in product.media -%}
          {% if media.media_type == 'image' %}
            {% capture sizes %}
								(min-width: 1100px) 535px, (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)
							{% endcapture %}
            {{
              media.preview_image
              | image_url: width: 720
              | image_tag:
                loading: 'lazy',
                sizes: sizes,
                widths: '165, 360, 533, 720, 940, 1066',
                class: 'motion-reduce',
                width: media.preview_image.width,
                height: media.preview_image.height,
                data-media-id: media.id
            }}
          {% else %}
            {% if media.media_type == 'model' %}
              <div class="product-media-modal__model" data-media-id="{{ media.id }}">
                <product-model class="deferred-media media" style="padding-bottom: 50%">
            {% else %}
              <deferred-media
                class="deferred-media media"
                style="padding-bottom: min(calc(100vh - 12rem), {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%)"
                data-media-id="{{ media.id }}"
              >
            {% endif %}

            <button id="Deferred-Poster-Modal-{{ media.id }}" class="deferred-media__poster" type="button">
              <span class="deferred-media__poster-button motion-reduce">
                {% if media.media_type == 'model' %}
                  {% render 'icon-3d-model' %}
                {% else %}
                  {% render 'icon-play' %}
                {% endif %}
              </span>
              {% assign image_height = media.preview_image.width | divided_by: media.preview_image.aspect_ratio %}

              {{
                media.preview_image
                | image_url: width: 3840
                | image_tag:
                  loading: 'lazy',
                  width: media.preview_image.width,
                  height: image_height,
                  sizes: '100vw',
                  widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840'
              }}
            </button>
            <template>
              {% case media.media_type %}
                {% when 'external_video' %}
                  {% assign video_class = 'js-' | append: media.host %}
                  {% if media.host == 'youtube' %}
                    {{
                      media
                      | external_video_url: autoplay: true, playlist: media.external_id
                      | external_video_tag: class: video_class, loading: 'lazy'
                    }}
                  {% else %}
                    {{
                      media
                      | external_video_url: autoplay: true, loop: loop
                      | external_video_tag: class: video_class, loading: 'lazy'
                    }}
                  {% endif %}
                {% when 'video' %}
                  {{
                    media
                    | media_tag: image_size: '2048x', autoplay: true, controls: true, preload: 'none', autoplay: true
                  }}
                {% when 'model' %}
                  {{ media | media_tag: image_size: '2048x', toggleable: true }}
              {% endcase %}
            </template>

            {% if media.media_type == 'model' %}
              </product-model>
              <button
                class="button button--full-width product__xr-button"
                type="button"
                aria-label="{{ 'products.product.xr_button_label' | t }}"
                data-shopify-xr
                data-shopify-model3d-id="{{ media.id }}"
                data-shopify-title="title"
                data-shopify-xr-hidden
              >
                {% render 'icon-3d-model' %}
                {{ 'products.product.xr_button' | t }}
              </button>
              </div>
            {% else %}
              </deferred-media>
            {% endif %}
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  </product-modal>
  <div class="ingredients-modal" style="display: none;">
    <div
      class="ingredients-modal__overlay"
      style="position: fixed; z-index: 999; top: 0; left: 0; height: 100%; width: 100%; background-color: rgba(0,0,0,.4)"
    >
      <div class="ingredients-modal__content" style="">
        <div class="ingredients-modal__close" style="display: flex; justify-content: right;">
          <span style="border: 1px solid black; border-radius: 50%; height: 30px; width: 30px; text-align: center"
            >x</span
          >
        </div>
        <h3 style="text-align: center">Scalp Serum</h3>
        <p style="line-height: 2.5rem">
          Water (Deionized, sterilized), Glycerine, Propylene glycol, GHK-Cu (Lysine, glycylhistidyl-, monocopper salt),
          AHK-Cu (L-Alanyl-L-histidyl-L-lysine â€“ copper), Thymulin (as nonathymulin) Zinc oxide, Pal-AHK (palmitoyl
          tripeptide -1), GHK Basic, PTD-DBM (Protein Transduction Domain-fused Dishevelled Binding Motif), Cucumis
          Sativus Fruit Extract, Diazolidinyl Urea, Rosa Damascena Flower Water, Iodopropynyl Butylcarbamate
        </p>
      </div>
    </div>
  </div>

  <div class="pre-order-modal" style="display: none">
    <div
      class="pre-order-modal__overlay"
      style="position: fixed; z-index: 999; top: 0; left: 0; height: 100%; width: 100%; background-color: rgba(0,0,0,.4)"
    >
      <div class="ingredients-modal__content" style="">
        <div class="pre-order-modal__close" style="display: flex; justify-content: right;">
          <span style="border: 1px solid black; border-radius: 50%; height: 30px; width: 30px; text-align: center"
            >x</span
          >
        </div>
        <h3 style="text-align: center">Pre-Ordered Item Conditions</h3>
        <p style="line-height: 2.5rem">
          Our viral hair serum is currently sold out and available for pre-order only. If your order includes this item,
          it will not ship until on or before October 5th, when we receive our inventory shipment.

          Please note: We do not offer refunds on pre-orders until the product has been received. Thank you for your
          patience and support!
        </p>
      </div>
    </div>
  </div>

  {%- liquid
    if product.selected_or_first_available_variant.featured_media
      assign seo_media = product.selected_or_first_available_variant.featured_media
    else
      assign seo_media = product.featured_media
    endif
  -%}

  <script type="application/ld+json">
    {
      "@context": "http://schema.org/",
      "@type": "Product",
      "name": {{ product.title | json }},
      "url": {{ request.origin | append: product.url | json }},
      {% if seo_media -%}
        "image": [
          {{ seo_media | image_url: width: 1920 | prepend: "https:" | json }}
        ],
      {%- endif %}
      "description": {{ product.description | strip_html | json }},
      {% if product.selected_or_first_available_variant.sku != blank -%}
        "sku": {{ product.selected_or_first_available_variant.sku | json }},
      {%- endif %}
      "brand": {
        "@type": "Brand",
        "name": {{ product.vendor | json }}
      },
      "offers": [
        {%- for variant in product.variants -%}
          {
            "@type" : "Offer",
            {%- if variant.sku != blank -%}
              "sku": {{ variant.sku | json }},
            {%- endif -%}
            {%- if variant.barcode.size == 12 -%}
              "gtin12": {{ variant.barcode }},
            {%- endif -%}
            {%- if variant.barcode.size == 13 -%}
              "gtin13": {{ variant.barcode }},
            {%- endif -%}
            {%- if variant.barcode.size == 14 -%}
              "gtin14": {{ variant.barcode }},
            {%- endif -%}
            "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
            "price" : {{ variant.price | divided_by: 100.00 | json }},
            "priceCurrency" : {{ cart.currency.iso_code | json }},
            "url" : {{ request.origin | append: variant.url | json }}
          }{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      ]
    }
  </script>
</section>
{% comment %}
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {
      const reviews = document.querySelectorAll(".reviews-container__review");
      let currentIndex = 0;

      function showNextReview() {
        reviews[currentIndex].classList.remove("active");
        currentIndex = (currentIndex + 1) % reviews.length; // Loop back to the first review
        reviews[currentIndex].classList.add("active");
      }

      setInterval(showNextReview, 4000); // Change review every 4 seconds
    });
  </script>
{% endcomment %}

<script type="text/javascript">
  // --- ACCORDION BORDER FIX ---
  // remove border from last list item
  const list = document.querySelectorAll('.product-about__accordion-item');

  if (window.innerWidth <= 1200 && list.length > 0) {
    const last = list[list.length - 1]; // Get the last item
    last.style.borderBottom = 'none'; // Remove the bottom border
  }

  // --- INGREDIENT MODAL LOGIC ---

  // Function to open the modal
  function openModal() {
    const modal = document.querySelector('.ingredients-modal');
    if (modal) {
      modal.style.display = 'block';
    }
  }

  // Function to close the modal
  function closeModal() {
    const modal = document.querySelector('.ingredients-modal');
    if (modal) {
      modal.style.display = 'none';
    }
  }

  // 1. Select ALL opening buttons (top and bottom)
  const openBtns = document.querySelectorAll('.ingredient-list');

  // 2. Loop through the NodeList and attach the click listener to EACH button (already includes null check implicitly via openBtns.length)
  if (openBtns.length > 0) {
    openBtns.forEach((button) => {
      button.addEventListener('click', openModal);
    });
  }

  // Select the single closing elements
  const closeBtn = document.querySelector('.ingredients-modal__close');
  const backdrop = document.querySelector('.ingredients-modal__overlay');

  // Attach the close listener to the closing elements (includes null checks)
  if (closeBtn) {
    closeBtn.addEventListener('click', closeModal);
  }
  if (backdrop) {
    backdrop.addEventListener('click', closeModal);
  }

  // --- PRE-ORDER MODAL LOGIC (The primary cause of the error) ---

  const openPreOrderBtn = document.querySelector('.pre-order__banner');
  const closePreOrderBtn = document.querySelector('.pre-order-modal__close');
  const preOrderBackdrop = document.querySelector('.pre-order-modal__overlay');

  function openPreOrderModal() {
    const modal = document.querySelector('.pre-order-modal');
    if (modal) {
      modal.style.display = 'block';
    }
  }

  function closePreOrderModal() {
    const modal = document.querySelector('.pre-order-modal');
    if (modal) {
      modal.style.display = 'none';
    }
  }

  // We MUST check if these elements exist before adding a listener
  if (openPreOrderBtn) {
    openPreOrderBtn.addEventListener('click', openPreOrderModal);
  }

  if (closePreOrderBtn) {
    closePreOrderBtn.addEventListener('click', closePreOrderModal);
  }

  if (preOrderBackdrop) {
    preOrderBackdrop.addEventListener('click', closePreOrderModal);
  }

  // --- JUDGEME AVATARS FIX ---
  // hide judgeMe avatars
  function hideAvatars() {
    const avatars = document.querySelectorAll('.jdgm-rev__icon');
    avatars.forEach(function (avatar) {
      avatar.style.display = 'none';
    });
  }

  window.addEventListener('load', hideAvatars);
</script>
<!-- update pricing options for each product -->
<script type="text/javascript">
  {%  case product.handle %}
    // update pricing options for single-bottle product page
    {% when 'bloom' %}

      // add buy 2 get 1 free purhcase option
      function updatePurchaseOptions(){
        // clone purchase element container
        const originalElement = document.querySelector('.appstle_subscription_wrapper_option');
        const originalElementLabel = originalElement.querySelector('.appstle_one_time_text')
        const clonedElement = originalElement.cloneNode(originalElement);
        clonedElement.setAttribute('data-variant-id', '44138710663347');

        // add custom class, remove id, update text and description
        clonedElement.classList.add('b2g1');
        const label = clonedElement.querySelector('.appstle_one_time_text');
        // label.textContent = 'Buy 2 Get 1 Free';
        label.textContent = '3 Bottles (1 free)'

        const descriptionText = clonedElement.querySelector('.appstle_one_time_description_text');
        descriptionText.textContent = 'Buy 2 Get 1 + Free Shipping';

        const price = clonedElement.querySelector('.transcy-money');
        price.textContent = "$76";
        price.style.marginLeft = "auto";
        price.style.fontWeight = "700";
        price.style.fontSize = "14px";
        price.style.color = "#dc1530";

        // add original price with strikethrough
        const originalPrice = document.createElement('span');
        originalPrice.classList.add('appstle_subscription_compare_amount', 'transcy-money');
        originalPrice.textContent = "$114";
        originalPrice.style.marginLeft = "5px";
        price.insertAdjacentElement('afterend', originalPrice);

        const originalID = clonedElement.querySelector('#appstle_selling_plan_label_10');
        originalID.id = "buy_2_get_1_free";

        // remove price class to stop update
        price.classList.remove('appstle_subscription_amount');

        // append element to list of purchase options
        const listItems = document.querySelector('.appstle_subscription_wrapper');
        listItems.insertBefore(clonedElement, listItems.children[1]);

        // create savings span for 1-bottle purchase option
        const oneBottleSavingsSpan = document.createElement('span');
          oneBottleSavingsSpan.classList.add('savings');
          oneBottleSavingsSpan.textContent = 'Save $0';
          originalElementLabel.appendChild(oneBottleSavingsSpan);

        // create savings span for b2g1 purchase option
        const b2g1SavingsSpan = document.createElement('span');
          b2g1SavingsSpan.classList.add('savings');
          b2g1SavingsSpan.textContent = 'Save $38';
          label.appendChild(b2g1SavingsSpan)

        // create savings span for subscription purchase option
        const subscriptionLabel = document.querySelector('.appstle_subscribe_save_text');
        const subscriptionSavingsSpan = document.createElement('span');
          subscriptionSavingsSpan.classList.add('savings');
          subscriptionSavingsSpan.textContent = 'Save $18';
          subscriptionLabel.appendChild(subscriptionSavingsSpan)

        // reapplies styles to subscription purchase option when reclicked
        document.addEventListener('click', function(event) {
            const subscriptionOption = event.target.closest('.appstle_subscription_wrapper_option');

            if (subscriptionOption) {
              setTimeout(() => {
                subscriptionSavingsSpan.classList.add('savings');
                subscriptionSavingsSpan.textContent = 'Save $18';
                subscriptionLabel.appendChild(subscriptionSavingsSpan)
              }, 100)


            }
        });

        // update the product id by chaning the value of the hidden input field name='id'
        const form = document.querySelector('form[action="/cart/add"]');
        const variantIdInput = form.querySelector('input[name="id"]');

        const purchaseOptions = document.querySelectorAll('.appstle_subscription_wrapper_option');

        purchaseOptions.forEach(option => {
          const radio = option.querySelector('input[type="radio"]');

          if (!radio) return;

          radio.addEventListener('change', () => {
            const selectedOption = radio.closest('.appstle_subscription_wrapper_option');

            // If this option has a custom variant id, override the form's variant input
            const customVariantId = selectedOption.getAttribute('data-variant-id');
            if (customVariantId) {
              variantIdInput.value = customVariantId;
              console.log('Updated variant ID to:', customVariantId);
            } else {
              // Optionally restore default variant ID
              variantIdInput.value = '44138306273459'; // Your base product's variant ID
              console.log('Restored to default variant ID');
            }
          });
        });


      }

      window.addEventListener('load', function() {
        setTimeout(updatePurchaseOptions, 1500);
      });


    {% when 'bloom-peptide-hair-serum-2-bottle' %}
      function updatePurchaseOptions(){

        // clone purchase element container
        const originalElement = document.querySelector('.appstle_subscription_wrapper_option');
        const originalElementLabel = originalElement.querySelector('.appstle_one_time_text')
        const clonedElement = originalElement.cloneNode(originalElement);
        clonedElement.setAttribute('data-variant-id', '44138710663347');

        // add custom class, remove id, update text and description
        clonedElement.classList.add('b2g1');
        const label = clonedElement.querySelector('.appstle_one_time_text');
        // label.textContent = 'Buy 2 Get 1 Free';
        label.textContent = '3 Bottles (1 free)'

        const descriptionText = clonedElement.querySelector('.appstle_one_time_description_text');
        descriptionText.textContent = 'Buy 2 Get 1 + Free Shipping';

        const price = clonedElement.querySelector('.transcy-money');
        price.textContent = "$76";
        price.style.marginLeft = "auto";
        price.style.fontWeight = "700";
        price.style.fontSize = "14px";
        price.style.color = "#dc1530";

        // add original price with strikethrough
        const originalPrice = document.createElement('span');
        originalPrice.classList.add('appstle_subscription_compare_amount', 'transcy-money');
        originalPrice.textContent = "$114";
        originalPrice.style.marginLeft = "5px";
        price.insertAdjacentElement('afterend', originalPrice);

        const originalID = clonedElement.querySelector('#appstle_selling_plan_label_10');
        originalID.id = "buy_2_get_1_free";

        // remove price class to stop update
        price.classList.remove('appstle_subscription_amount');

        // append element to list of purchase options
        const listItems = document.querySelector('.appstle_subscription_wrapper');
        listItems.insertBefore(clonedElement, listItems.children[1]);

        // udpate lable from 1 bottle to 2 bottles
        const twoBottleLabel = document.querySelector('.appstle_one_time_text')
        twoBottleLabel.textContent = '2 Bottles';

        // create savings span for 1-bottle purchase option
        const twoBottleSavingsSpan = document.createElement('span');
          twoBottleSavingsSpan.classList.add('savings');
          twoBottleSavingsSpan.textContent = 'Save $0';
          twoBottleLabel.appendChild(twoBottleSavingsSpan);

        // create savings span for b2g1 purchase option
        const b2g1SavingsSpan = document.createElement('span');
          b2g1SavingsSpan.classList.add('savings');
          b2g1SavingsSpan.textContent = 'Save $38';
          label.appendChild(b2g1SavingsSpan)

        // create savings span for subscription purchase option
        const subscriptionLabel = document.querySelector('.appstle_subscribe_save_text');
        const subscriptionSavingsSpan = document.createElement('span');
          subscriptionSavingsSpan.classList.add('savings');
          subscriptionSavingsSpan.textContent = 'Save $16';
          subscriptionLabel.appendChild(subscriptionSavingsSpan);

        // reapplies styles to subscription purchase option when reclicked
        document.addEventListener('click', function(event) {
            const subscriptionOption = event.target.closest('.appstle_subscription_wrapper_option');

            if (subscriptionOption) {
              setTimeout(() => {
                subscriptionSavingsSpan.classList.add('savings');
                subscriptionSavingsSpan.textContent = 'Save $36';
                subscriptionLabel.appendChild(subscriptionSavingsSpan)
              }, 100)


            }
        });

        // update the product id by chaning the value of the hidden input field name='id'
        const form = document.querySelector('form[action="/cart/add"]');
        const variantIdInput = form.querySelector('input[name="id"]');

        const purchaseOptions = document.querySelectorAll('.appstle_subscription_wrapper_option');

        purchaseOptions.forEach(option => {
          const radio = option.querySelector('input[type="radio"]');

          if (!radio) return;

          radio.addEventListener('change', () => {
            const selectedOption = radio.closest('.appstle_subscription_wrapper_option');

            // If this option has a custom variant id, override the form's variant input
            const customVariantId = selectedOption.getAttribute('data-variant-id');
            if (customVariantId) {
              variantIdInput.value = customVariantId;
              console.log('Updated variant ID to:', customVariantId);
            } else {
              // Optionally restore default variant ID
              variantIdInput.value = '44138306273459'; // Your base product's variant ID
              console.log('Restored to default variant ID');
            }
          });
        });

      }

      window.addEventListener('load', function() {
        setTimeout(updatePurchaseOptions, 1500);
      });


    {% when 'bloom-peptide-hair-serum-3-bottle' %}
      function updatePurchaseOptions(){

        // clone purchase element container
        const originalElement = document.querySelector('.appstle_subscription_wrapper_option');
        const originalElementLabel = originalElement.querySelector('.appstle_one_time_text')
        const clonedElement = originalElement.cloneNode(originalElement);
        clonedElement.setAttribute('data-variant-id', '44138710663347');

        // add custom class, remove id, update text and description
        clonedElement.classList.add('b2g1');
        const label = clonedElement.querySelector('.appstle_one_time_text');
        label.textContent = '3 Bottles (1 free)'
        // label.textContent = '3 Bottles+D-Stamp'

        const descriptionText = clonedElement.querySelector('.appstle_one_time_description_text');
        // descriptionText.textContent = 'Buy 3 Get Free Derma Stamp + Free Shipping';
        descriptionText.textContent = 'Buy 2 Get 1 + Free Shipping';

        const price = clonedElement.querySelector('.transcy-money');
        price.textContent = "$76";
        price.style.marginLeft = "auto";
        price.style.fontWeight = "700";
        price.style.fontSize = "14px";
        price.style.color = "#dc1530";

        // add original price with strikethrough
        const originalPrice = document.createElement('span');
        originalPrice.classList.add('appstle_subscription_compare_amount', 'transcy-money');
        originalPrice.textContent = "$114";
        originalPrice.style.marginLeft = "5px";
        price.insertAdjacentElement('afterend', originalPrice);

        const originalID = clonedElement.querySelector('#appstle_selling_plan_label_10');
        // originalID.id = "buy_3_get_1_free";
        originalID.id = "buy_2_get_1_free";

        // remove price class to stop update
        price.classList.remove('appstle_subscription_amount');

        // append element to list of purchase options
        const listItems = document.querySelector('.appstle_subscription_wrapper');
        listItems.insertBefore(clonedElement, listItems.children[1]);

        // udpate lable from 1 bottle to 2 bottles
        const twoBottleLabel = document.querySelector('.appstle_one_time_text')
        twoBottleLabel.textContent = '3 Bottles';

        // create savings span for 1-bottle purchase option
        const twoBottleSavingsSpan = document.createElement('span');
          twoBottleSavingsSpan.classList.add('savings');
          twoBottleSavingsSpan.textContent = 'Save $0';
          twoBottleLabel.appendChild(twoBottleSavingsSpan);

        // create savings span for b2g1 purchase option
        const b2g1SavingsSpan = document.createElement('span');
          b2g1SavingsSpan.classList.add('savings');
          b2g1SavingsSpan.textContent = 'Save $38';
          label.appendChild(b2g1SavingsSpan)

        // create savings span for subscription purchase option
        const subscriptionLabel = document.querySelector('.appstle_subscribe_save_text');
        const subscriptionSavingsSpan = document.createElement('span');
          subscriptionSavingsSpan.classList.add('savings');
          subscriptionSavingsSpan.textContent = 'Save $24';
          subscriptionLabel.appendChild(subscriptionSavingsSpan);

        // reapplies styles to subscription purchase option when reclicked
        document.addEventListener('click', function(event) {
            const subscriptionOption = event.target.closest('.appstle_subscription_wrapper_option');

            if (subscriptionOption) {
              setTimeout(() => {
                subscriptionSavingsSpan.classList.add('savings');
                subscriptionSavingsSpan.textContent = 'Save $54';
                subscriptionLabel.appendChild(subscriptionSavingsSpan)
              }, 100)


            }
        });

        // update the product id by chaning the value of the hidden input field name='id'
        const form = document.querySelector('form[action="/cart/add"]');
        const variantIdInput = form.querySelector('input[name="id"]');

        const purchaseOptions = document.querySelectorAll('.appstle_subscription_wrapper_option');

        purchaseOptions.forEach(option => {
          const radio = option.querySelector('input[type="radio"]');

          if (!radio) return;

          radio.addEventListener('change', () => {
            const selectedOption = radio.closest('.appstle_subscription_wrapper_option');

            // If this option has a custom variant id, override the form's variant input
            const customVariantId = selectedOption.getAttribute('data-variant-id');
            if (customVariantId) {
              variantIdInput.value = customVariantId;
              console.log('Updated variant ID to:', customVariantId);
            } else {
              // Optionally restore default variant ID
              variantIdInput.value = '44138306273459'; // Your base product's variant ID
              console.log('Restored to default variant ID');
            }
          });
        });

      }

      window.addEventListener('load', function() {
        setTimeout(updatePurchaseOptions, 1500);
      });


    {% endcase %}


  // function rearrangePurchaseOptions() {
  //   const wrapper = document.querySelector(".appstle_subscription_wrapper");
  //   const groupArray = [...document.querySelectorAll('.appstle_subscription_wrapper_option')];

  //   // Swap elements at index 0 and 1
  //   [groupArray[1], groupArray[2]] = [groupArray[2], groupArray[1]];

  //   groupArray.forEach(element => wrapper.appendChild(element));

  //   // Select the "Buy 2 Get 1 Free" radio button
  //   let buy2Get1Option = document.querySelector('input[id="buy_2_get_1_free"]');

  //   // Select the subscription option (pre-checked one)
  //   let subscriptionOption = document.querySelector('input[id="appstle_selling_plan_label_20"]');

  //   if (buy2Get1Option && subscriptionOption) {
  //       // Uncheck subscription
  //       subscriptionOption.checked = false;

  //       // Check "Buy 2 Get 1 Free"
  //       buy2Get1Option.checked = true;

  //       // Dispatch change event to trigger any Appstle listeners
  //       buy2Get1Option.dispatchEvent(new Event('change', { bubbles: true }));
  //   }

  // }

  // window.addEventListener('load', function() {
  //   setTimeout(rearrangePurchaseOptions, 1500)
  // })
</script>

<script type="text/javascript">
  function addVerificationBadge() {
    // Get the list of authors
    const authors = document.querySelectorAll('.jdgm-rev__author-wrapper');

    // Add 'verified' badge for each author if it doesn't exist
    authors.forEach((author) => {
      // Check if third party badge already exists and return if true
      const classCheck = 'jdgm-rev__verification-badge-img';
      const hasClass = author.querySelector(`.${classCheck}`);
      if (hasClass) {
        console.log('Third party badge. Skipping.');
        return;
      }

      // Check if the verified badge already exists to prevent duplicates
      const existingBadge = author.querySelector('.jdgm-rev__buyer-badge');
      if (existingBadge) {
        console.log('Buyer badge already exists. Skipping.');
        return; // Skip if badge already exists
      }

      // Create a new buyer badge wrapper for each author
      const buyerBadgeWrapper = document.createElement('span');
      buyerBadgeWrapper.classList.add('jdgm-rev__buyer-badge-wrapper');

      // Create a new buyer badge
      const buyerBadge = document.createElement('span');
      buyerBadge.classList.add('jdgm-rev__buyer-badge');
      // buyerBadge.textContent = 'Verified';

      // Append the buyer badge to the wrapper
      buyerBadgeWrapper.appendChild(buyerBadge);

      // Insert the badge wrapper next to the author
      author.appendChild(buyerBadgeWrapper);
    });
  }

  // Add verified badges when page intitially loads
  window.addEventListener('load', addVerificationBadge);

  // Add verified badges when user clicks pagination buttons
  document.addEventListener('click', function (event) {
    if (event.target.matches('.jdgm-paginate__page')) {
      // Replace with the correct selector for your pagination
      setTimeout(() => {
        addVerificationBadge();
      }, 1000); // Adjust timeout duration if necessary
    }
  });
</script>

{% javascript %}
  class ProductModal extends ModalDialog {
    constructor() {
      super();
    }

    hide() {
      super.hide();
      window.pauseAllMedia();
    }

    show(opener) {
      super.show(opener);
      this.showActiveMedia();
    }

    showActiveMedia() {
      this.querySelectorAll(
        `[data-media-id]:not([data-media-id="${this.openedBy.getAttribute('data-media-id')}"])`
      ).forEach((element) => {
        element.classList.remove('active');
      });
      const activeMedia = this.querySelector(`[data-media-id="${this.openedBy.getAttribute('data-media-id')}"]`);
      if (activeMedia) {
        activeMedia.classList.add('active');
        activeMedia.scrollIntoView();
      }

      if (
        activeMedia.nodeName == 'DEFERRED-MEDIA' &&
        activeMedia.querySelector('template')?.content?.querySelector('.js-youtube')
      )
        activeMedia.loadContent();
    }
  }

  class ProductRecommendations extends HTMLElement {
    constructor() {
      super();

      const handleIntersection = (entries, observer) => {
        if (!entries[0].isIntersecting) return;
        observer.unobserve(this);

        fetch(this.dataset.url)
          .then((response) => response.text())
          .then((text) => {
            const html = document.createElement('div');
            html.innerHTML = text;
            const recommendations = html.querySelector('product-recommendations--single');
            if (recommendations && recommendations.innerHTML.trim().length) {
              this.innerHTML = recommendations.innerHTML;
            }
          })
          .catch((e) => {
            console.error(e);
          });
      };

      new IntersectionObserver(handleIntersection.bind(this), { rootMargin: '0px 0px 200px 0px' }).observe(this);
    }
  }

  customElements.define('product-modal', ProductModal);
  customElements.define('product-recommendations--single', ProductRecommendations);
{% endjavascript %}

{%- if first_3d_model -%}
  <script type="application/json" id="ProductJSON-{{ product.id }}">
    {{ product.media | where: 'media_type', 'model' | json }}
  </script>

  <script src="{{ 'product-model.js' | asset_url }}" defer></script>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.main-product.name",
  "tag": "section",
  "class": "product-section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "default": "background-2",
      "label": "t:sections.all.color_scheme.label"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header.content",
      "info": "t:sections.main-product.settings.header.info"
    },
    {
      "type": "select",
      "id": "image_gallery_collage",
      "info": "t:sections.main-product.settings.image_collage.info",
      "options": [
        {
          "value": "stacked",
          "label": "t:sections.main-product.settings.image_collage.options__1.label"
        },
        {
          "value": "thumbnail_carousel",
          "label": "t:sections.main-product.settings.image_collage.options__2.label"
        },
        {
          "value": "thumbnail",
          "label": "t:sections.main-product.settings.image_collage.options__3.label"
        }
      ],
      "default": "thumbnail_carousel",
      "label": "t:sections.main-product.settings.image_collage.label"
    },
    {
      "type": "select",
      "id": "desktop_alignment",
      "options": [
        {
          "value": "right",
          "label": "t:sections.main-product.settings.desktop_alignment.options__1.label"
        },
        {
          "value": "left",
          "label": "t:sections.main-product.settings.desktop_alignment.options__2.label"
        }
      ],
      "default": "left",
      "label": "t:sections.main-product.settings.desktop_alignment.label"
    },
    {
      "type": "select",
      "id": "mobile_alignment",
      "options": [
        {
          "value": "after",
          "label": "t:sections.main-product.settings.mobile_alignment.options__1.label"
        },
        {
          "value": "before",
          "label": "t:sections.main-product.settings.mobile_alignment.options__2.label"
        }
      ],
      "default": "before",
      "label": "t:sections.main-product.settings.mobile_alignment.label"
    },
    {
      "type": "select",
      "id": "image_fit",
      "options": [
        {
          "value": "cover",
          "label": "t:sections.main-product.settings.image_fit.options__1.label"
        },
        {
          "value": "contain",
          "label": "t:sections.main-product.settings.image_fit.options__2.label"
        }
      ],
      "default": "cover",
      "label": "t:sections.main-product.settings.image_fit.label"
    },
    {
      "type": "checkbox",
      "id": "enable_autoheight",
      "default": true,
      "label": "t:sections.main-product.settings.enable_autoheight.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.section-padding.header.content"
    },
    {
      "type": "select",
      "id": "padding_top",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-padding.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-padding.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-padding.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-padding.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-padding.options__5.label"
        }
      ],
      "default": "no-indent",
      "label": "t:sections.all.section-padding.padding_top.label"
    },
    {
      "type": "select",
      "id": "padding_bottom",
      "options": [
        {
          "value": "no-indent",
          "label": "t:sections.all.section-padding.options__1.label"
        },
        {
          "value": "xs",
          "label": "t:sections.all.section-padding.options__2.label"
        },
        {
          "value": "s",
          "label": "t:sections.all.section-padding.options__3.label"
        },
        {
          "value": "m",
          "label": "t:sections.all.section-padding.options__4.label"
        },
        {
          "value": "l",
          "label": "t:sections.all.section-padding.options__5.label"
        }
      ],
      "default": "no-indent",
      "label": "t:sections.all.section-padding.padding_bottom.label"
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "text",
      "name": "t:sections.main-product.blocks.text.name",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "default": "Text block",
          "label": "t:sections.main-product.blocks.text.settings.text.label"
        }
      ]
    },
    {
      "type": "title",
      "name": "t:sections.main-product.blocks.title.name",
      "limit": 1
    },
    {
      "type": "price",
      "name": "t:sections.main-product.blocks.price.name",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "t:sections.main-product.blocks.variant_picker.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "picker_type",
          "options": [
            {
              "value": "dropdown",
              "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.options__1.label"
            },
            {
              "value": "button",
              "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.options__2.label"
            }
          ],
          "default": "dropdown",
          "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.label"
        }
      ]
    },
    {
      "type": "about",
      "name": "t:sections.main-product.blocks.about.name",
      "limit": 5,
      "settings": [
        {
          "type": "text",
          "id": "about_heading",
          "default": "Some title",
          "label": "t:sections.main-product.blocks.about.settings.heading.label"
        },
        {
          "type": "richtext",
          "id": "about_heading_content",
          "default": "<p>Some description</p>",
          "label": "t:sections.main-product.blocks.about.settings.text.label"
        }
      ]
    },
    {
      "type": "description",
      "name": "t:sections.main-product.blocks.description.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "description_heading",
          "default": "Description",
          "label": "t:sections.main-product.blocks.description.settings.heading.label",
          "info": "t:sections.main-product.blocks.description.settings.heading.info"
        },
        {
          "type": "checkbox",
          "id": "default_open",
          "default": false,
          "label": "t:sections.all.collapsible.default_open.label",
          "info": "t:sections.all.collapsible.default_open.info"
        },
        {
          "type": "select",
          "id": "description_variants",
          "options": [
            {
              "value": "collapsible",
              "label": "t:sections.main-product.blocks.description.settings.description_variants.options__1.label"
            },
            {
              "value": "fixed",
              "label": "t:sections.main-product.blocks.description.settings.description_variants.options__2.label"
            }
          ],
          "default": "collapsible",
          "label": "t:sections.main-product.blocks.description.settings.description_variants.label"
        }
      ]
    },
    {
      "type": "buy_buttons",
      "name": "t:sections.main-product.blocks.buy_buttons.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "default": true,
          "label": "t:sections.main-product.blocks.buy_buttons.settings.show_dynamic_checkout.label",
          "info": "t:sections.main-product.blocks.buy_buttons.settings.show_dynamic_checkout.info"
        },
        {
          "type": "checkbox",
          "id": "show_quantity",
          "default": true,
          "label": "t:sections.main-product.blocks.buy_buttons.settings.show_quantity.label"
        },
        {
          "type": "checkbox",
          "id": "show_gift_card_recipient",
          "default": false,
          "label": "t:sections.main-product.blocks.buy_buttons.settings.show_gift_card_recipient.label",
          "info": "t:sections.main-product.blocks.buy_buttons.settings.show_gift_card_recipient.info"
        },
        {
          "type": "text",
          "id": "buy_once_extra_text",
          "label": "Buy Once Extra Text"
        },
        {
          "type": "text",
          "id": "below_extra_text",
          "label": "Below Extra Text"
        }
      ]
    },
    {
      "type": "popup",
      "name": "t:sections.main-product.blocks.popup.name",
      "limit": 2,
      "settings": [
        {
          "id": "label",
          "type": "text",
          "default": "Pop-up link text",
          "label": "t:sections.main-product.blocks.popup.settings.link_label.label"
        },
        {
          "id": "heading",
          "type": "text",
          "default": "Popup heading",
          "label": "t:sections.main-product.blocks.popup.settings.heading.label"
        },
        {
          "id": "text",
          "type": "richtext",
          "default": "<p>Some text</p>",
          "label": "t:sections.main-product.blocks.popup.settings.text.label"
        },
        {
          "type": "page",
          "id": "page",
          "label": "t:sections.main-product.blocks.popup.settings.page.label"
        }
      ]
    },
    {
      "type": "tags",
      "name": "t:sections.main-product.blocks.tags.name",
      "limit": 1
    },
    {
      "type": "share",
      "name": "t:sections.main-product.blocks.share.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_share_facebook",
          "default": true,
          "label": "t:sections.main-product.blocks.share.settings.show_share_facebook.label"
        },
        {
          "type": "checkbox",
          "id": "show_share_twitter",
          "default": true,
          "label": "t:sections.main-product.blocks.share.settings.show_share_twitter.label"
        },
        {
          "type": "checkbox",
          "id": "show_share_pinterest",
          "default": true,
          "label": "t:sections.main-product.blocks.share.settings.show_share_pinterest.label"
        },
        {
          "type": "checkbox",
          "id": "show_share_copy",
          "default": true,
          "label": "t:sections.main-product.blocks.share.settings.show_share_copy.label"
        }
      ]
    },
    {
      "type": "buy_with",
      "name": "t:sections.main-product.blocks.buy_with.name",
      "limit": 1
    },
    {
      "type": "benefits_list",
      "name": "Benefits List",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        { "type": "header", "content": "List Items (Up to 10)" },
        { "type": "text", "id": "text_1", "label": "Benefit 1", "default": "Regrows hair" },
        { "type": "text", "id": "text_2", "label": "Benefit 2", "default": "Thickens hair" },
        { "type": "text", "id": "text_3", "label": "Benefit 3", "default": "Strengthens roots" },
        { "type": "text", "id": "text_4", "label": "Benefit 4", "default": "Nourishes scalp" },
        { "type": "text", "id": "text_5", "label": "Benefit 5", "default": "Prevents shedding" },
        { "type": "text", "id": "text_6", "label": "Benefit 6" },
        { "type": "text", "id": "text_7", "label": "Benefit 7" },
        { "type": "text", "id": "text_8", "label": "Benefit 8" },
        { "type": "text", "id": "text_9", "label": "Benefit 9" },
        { "type": "text", "id": "text_10", "label": "Benefit 10" }
      ]
    },
    {
      "type": "pickup_availability",
      "name": "t:sections.main-product.blocks.pickup_availability.name",
      "limit": 1
    },
    {
      "type": "complementary",
      "name": "t:sections.main-product.blocks.complementary_products.name",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "t:sections.main-product.blocks.complementary_products.settings.paragraph.content"
        },
        {
          "type": "range",
          "id": "product_list_limit",
          "min": 1,
          "max": 3,
          "step": 1,
          "default": 1,
          "label": "t:sections.main-product.blocks.complementary_products.settings.product_list_limit.label"
        }
      ]
    },
    {
      "type": "double_media",
      "name": "Double Media",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_undermedia",
          "label": "Show Block Under Media"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image 1"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile 1"
        },
        {
          "type": "image_picker",
          "id": "image1",
          "label": "Image 2"
        },
        {
          "type": "image_picker",
          "id": "mobile_image1",
          "label": "Mobile 2"
        }
      ]
    },
    {
      "type": "grid_video_image_slider",
      "name": "Grid Video Image Slider",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_undermedia",
          "label": "Show Block Under Media"
        },
        {
          "type": "image_picker",
          "id": "bg_image",
          "label": "Background Image"
        },

        {
          "type": "header",
          "content": "Left part"
        },
        {
          "type": "image_picker",
          "id": "left_image",
          "label": "Static Image (Fallback)"
        },
        {
          "type": "video",
          "id": "video_loop",
          "label": "Preview Loop Video (MP4, 4â€“6s)"
        },
        {
          "type": "video",
          "id": "video_full",
          "label": "Full Length Video (MP4)"
        },

        {
          "type": "header",
          "content": "Right part"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text Color"
        },
        {
          "type": "text",
          "id": "footer_text",
          "label": "Title"
        },

        {
          "type": "header",
          "content": "Slider Content"
        },
        {
          "type": "text",
          "id": "title1",
          "label": "Title 1"
        },
        {
          "type": "text",
          "id": "subtitle1",
          "label": "Text 1"
        },
        {
          "type": "text",
          "id": "title2",
          "label": "Title 2"
        },
        {
          "type": "text",
          "id": "subtitle2",
          "label": "Text 2"
        },
        {
          "type": "text",
          "id": "title3",
          "label": "Title 3"
        },
        {
          "type": "text",
          "id": "subtitle3",
          "label": "Text 3"
        },
        {
          "type": "text",
          "id": "title4",
          "label": "Title 4"
        },
        {
          "type": "text",
          "id": "subtitle4",
          "label": "Text 4"
        }
      ]
    },
    {
      "type": "single_media",
      "name": "Single Media",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_undermedia",
          "label": "Show Block Under Media"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile Image"
        }
      ]
    },
    {
      "type": "before_after",
      "name": "Before After",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_undermedia",
          "label": "Show Block Under Media"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image 1"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Image Label 1"
        },
        {
          "type": "image_picker",
          "id": "image1",
          "label": "Image 2"
        },
        {
          "type": "text",
          "id": "text1",
          "label": "Image Label 2"
        }
      ]
    },
    {
      "type": "custom_liquid",
      "name": "t:sections.main-product.blocks.custom_liquid.name",
      "settings": [
        {
          "type": "liquid",
          "id": "custom_liquid",
          "label": "t:sections.main-product.blocks.custom_liquid.settings.custom_liquid.label",
          "info": "t:sections.main-product.blocks.custom_liquid.settings.custom_liquid.info"
        }
      ]
    },
    {
      "type": "vendor",
      "name": "t:sections.main-product.blocks.vendor.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "enable_vendor_link",
          "default": false,
          "label": "t:sections.main-product.blocks.vendor.settings.enable_vendor_link.label"
        }
      ]
    },
    {
      "type": "inventory",
      "name": "t:sections.main-product.blocks.inventory.name",
      "limit": 1,
      "settings": []
    },
    {
      "type": "additional_text",
      "name": "t:sections.main-product.blocks.additional_text.name",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "default": "<p>Some text</p>",
          "label": "t:sections.contact-form.settings.text.label"
        },
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "default": "background-6",
          "label": "t:sections.all.color_scheme.label"
        }
      ]
    },
    {
      "type": "sku",
      "name": "t:sections.all.sku.name",
      "limit": 1
    },
    {
      "type": "icon-with-text",
      "name": "t:sections.main-product.blocks.icon_with_text.name",
      "settings": [
        {
          "type": "select",
          "id": "layout",
          "options": [
            {
              "value": "horizontal",
              "label": "t:sections.main-product.blocks.icon_with_text.settings.layout.options__1.label"
            },
            {
              "value": "vertical",
              "label": "t:sections.main-product.blocks.icon_with_text.settings.layout.options__2.label"
            }
          ],
          "default": "horizontal",
          "label": "t:sections.main-product.blocks.icon_with_text.settings.layout.label"
        },
        {
          "type": "header",
          "content": "t:sections.main-product.blocks.icon_with_text.settings.content.label",
          "info": "t:sections.main-product.blocks.icon_with_text.settings.content.info"
        },
        {
          "type": "select",
          "id": "icon_1",
          "options": [
            {
              "value": "none",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.none"
            },
            {
              "value": "icon_1",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_1"
            },
            {
              "value": "icon_2",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_2"
            },
            {
              "value": "icon_3",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_3"
            },
            {
              "value": "icon_4",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_4"
            },
            {
              "value": "icon_5",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_5"
            },
            {
              "value": "icon_6",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_6"
            },
            {
              "value": "icon_7",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_7"
            },
            {
              "value": "icon_8",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_8"
            },
            {
              "value": "icon_9",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_9"
            },
            {
              "value": "icon_10",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_10"
            },
            {
              "value": "icon_11",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_11"
            },
            {
              "value": "icon_12",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_12"
            },
            {
              "value": "icon_13",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_13"
            },
            {
              "value": "icon_14",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_14"
            },
            {
              "value": "icon_15",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_15"
            },
            {
              "value": "icon_16",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_16"
            },
            {
              "value": "icon_17",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_17"
            },
            {
              "value": "icon_18",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_18"
            },
            {
              "value": "icon_19",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_19"
            },
            {
              "value": "icon_20",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_20"
            },
            {
              "value": "icon_21",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_21"
            },
            {
              "value": "icon_22",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_22"
            },
            {
              "value": "icon_23",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_23"
            },
            {
              "value": "icon_24",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_24"
            },
            {
              "value": "icon_25",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_25"
            },
            {
              "value": "icon_26",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_26"
            }
          ],
          "default": "icon_17",
          "label": "t:sections.all.icons_accardion.settings.icon.label"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "t:sections.main-product.blocks.icon_with_text.settings.image_1.label"
        },
        {
          "type": "inline_richtext",
          "id": "heading_1",
          "default": "Heading",
          "label": "t:sections.main-product.blocks.icon_with_text.settings.heading_1.label",
          "info": "t:sections.main-product.blocks.icon_with_text.settings.heading.info"
        },
        {
          "type": "select",
          "id": "icon_2",
          "options": [
            {
              "value": "none",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.none"
            },
            {
              "value": "icon_1",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_1"
            },
            {
              "value": "icon_2",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_2"
            },
            {
              "value": "icon_3",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_3"
            },
            {
              "value": "icon_4",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_4"
            },
            {
              "value": "icon_5",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_5"
            },
            {
              "value": "icon_6",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_6"
            },
            {
              "value": "icon_7",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_7"
            },
            {
              "value": "icon_8",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_8"
            },
            {
              "value": "icon_9",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_9"
            },
            {
              "value": "icon_10",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_10"
            },
            {
              "value": "icon_11",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_11"
            },
            {
              "value": "icon_12",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_12"
            },
            {
              "value": "icon_13",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_13"
            },
            {
              "value": "icon_14",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_14"
            },
            {
              "value": "icon_15",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_15"
            },
            {
              "value": "icon_16",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_16"
            },
            {
              "value": "icon_17",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_17"
            },
            {
              "value": "icon_18",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_18"
            }
          ],
          "default": "icon_1",
          "label": "t:sections.all.icons_accardion.settings.icon.label"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "t:sections.main-product.blocks.icon_with_text.settings.image_2.label"
        },
        {
          "type": "inline_richtext",
          "id": "heading_2",
          "default": "Heading",
          "label": "t:sections.main-product.blocks.icon_with_text.settings.heading_2.label",
          "info": "t:sections.main-product.blocks.icon_with_text.settings.heading.info"
        },
        {
          "type": "select",
          "id": "icon_3",
          "options": [
            {
              "value": "none",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.none"
            },
            {
              "value": "icon_1",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_1"
            },
            {
              "value": "icon_2",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_2"
            },
            {
              "value": "icon_3",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_3"
            },
            {
              "value": "icon_4",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_4"
            },
            {
              "value": "icon_5",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_5"
            },
            {
              "value": "icon_6",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_6"
            },
            {
              "value": "icon_7",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_7"
            },
            {
              "value": "icon_8",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_8"
            },
            {
              "value": "icon_9",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_9"
            },
            {
              "value": "icon_10",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_10"
            },
            {
              "value": "icon_11",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_11"
            },
            {
              "value": "icon_12",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_12"
            },
            {
              "value": "icon_13",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_13"
            },
            {
              "value": "icon_14",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_14"
            },
            {
              "value": "icon_15",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_15"
            },
            {
              "value": "icon_16",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_16"
            },
            {
              "value": "icon_17",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_17"
            },
            {
              "value": "icon_18",
              "label": "t:sections.all.icons_accardion.settings.icon.icons.icon_18"
            }
          ],
          "default": "icon_3",
          "label": "t:sections.all.icons_accardion.settings.icon.label"
        },
        {
          "type": "image_picker",
          "id": "image_3",
          "label": "t:sections.main-product.blocks.icon_with_text.settings.image_3.label"
        },
        {
          "type": "inline_richtext",
          "id": "heading_3",
          "default": "Heading",
          "label": "t:sections.main-product.blocks.icon_with_text.settings.heading_3.label",
          "info": "t:sections.main-product.blocks.icon_with_text.settings.heading.info"
        }
      ]
    }
  ]
}
{% endschema %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.col-left-media').forEach(function (block) {
      // prevent double binding (Shopify can re-render sections)
      if (block.dataset.gvimBound === '1') return;
      block.dataset.gvimBound = '1';

      var video = block.querySelector('video');
      var btn = block.querySelector('.col-left-mediaplay-pause-btn');
      var playIcon = block.querySelector('.play-button');
      var pauseIcon = block.querySelector('.pause-btn');

      if (!video || !btn || !playIcon || !pauseIcon) return;

      // ----- DEFAULT STATE: preview loop -----
      block.classList.remove('is-full');
      video.muted = true;
      video.loop = true;
      video.controls = false;
      video.playsInline = true;
      video.setAttribute('playsinline', '');

      // Autoplay preview loop (safe, muted)
      try {
        video.play();
      } catch (e) {}

      // Icon default: show PLAY (because clicking enters "full")
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';

      function enterFull() {
        block.classList.add('is-full');

        // Switch to full playback
        video.loop = false;

        // If you NEVER want audio, keep this true:
        // video.muted = true;
        // If you want audio when user clicks play:
        video.muted = false;

        video.controls = true;

        var p = video.play();
        if (p && typeof p.catch === 'function') p.catch(function () {});

        // Icon: show PAUSE (meaning click will exit full)
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
      }

      function exitFull() {
        // Pause + reset to preview loop
        video.pause();
        video.currentTime = 0; // restart preview
        video.controls = false;
        video.muted = true;
        video.loop = true;

        block.classList.remove('is-full');

        var p = video.play();
        if (p && typeof p.catch === 'function') p.catch(function () {});

        // Icon: show PLAY again
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
      }

      btn.addEventListener('click', function () {
        if (block.classList.contains('is-full')) exitFull();
        else enterFull();
      });

      // When full video ends, return to preview mode
      video.addEventListener('ended', function () {
        exitFull();
      });
    });
  });
</script>
