{{ 'timeline-gallery.css' | asset_url | stylesheet_tag }}

{% style %}
  .section-{{ section.id }}-padding {
  {% if section.settings.padding_top == 'no-indent' %}
    padding-top: 0;
  {% else %}
    padding-top: 3.2rem; 
  {% endif %} 

  {% if section.settings.padding_bottom == 'no-indent' %}
    padding-bottom: 0;
  {% else %}
    padding-bottom: 3.2rem;
  {% endif %}
}
  
@media screen and (min-width: 990px) { 
  .section-{{ section.id }}-padding {
    {% if section.settings.padding_top == 'no-indent' %}
      padding-top: 0;
    {% elsif section.settings.padding_top == 'l' %}
      padding-top: 4rem;
    {% else %}
      padding-top: 3.2rem;
    {% endif %}

    {% if section.settings.padding_bottom == 'no-indent' %}
      padding-bottom: 0;
    {% elsif section.settings.padding_bottom == 'l' %}
      padding-bottom: 4rem;
    {% else %}
      padding-bottom: 3.2rem;
    {% endif %}
  }
}

@media screen and (min-width: 1200px) { 
  .section-{{ section.id }}-padding {
    {% if section.settings.padding_top == 'no-indent' %}
      padding-top: 0;
    {% elsif section.settings.padding_top == 'l' %}
      padding-top: 8rem;
    {% elsif section.settings.padding_top == 'm' %}
      padding-top: 4rem;
    {% else %}
      padding-top: 3.2rem;
    {% endif %}

    {% if section.settings.padding_bottom == 'no-indent' %}
      padding-bottom: 0;
    {% elsif section.settings.padding_bottom == 'l' %}
      padding-bottom: 8rem;
    {% elsif section.settings.padding_bottom == 'm' %}
      padding-bottom: 4rem;
    {% else %}
      padding-bottom: 3.2rem;
    {% endif %}
  }
}

@media screen and (min-width: 1560px) { 
  .section-{{ section.id }}-padding {
    {% if section.settings.padding_top == 'no-indent' %}
      padding-top: 0;
    {% elsif section.settings.padding_top == 'l' %}
      padding-top: 16rem;
    {% elsif section.settings.padding_top == 'm' %}
      padding-top: 8rem;
    {% elsif section.settings.padding_top == 's' %}
      padding-top: 4rem;
    {% else %}
      padding-top: 3.2rem;
    {% endif %}

    {% if section.settings.padding_bottom == 'no-indent' %}
      padding-bottom: 0;
    {% elsif section.settings.padding_bottom == 'l' %}
      padding-bottom: 16rem;
    {% elsif section.settings.padding_bottom == 'm' %}
      padding-bottom: 8rem;
    {% elsif section.settings.padding_bottom == 's' %}
      padding-bottom: 4rem;
    {% else %}
      padding-bottom: 3.2rem;
    {% endif %}
  }
}

/* =========================================================
   âœ… Scroll reveal (scoped per section instance)
   ========================================================= */
.timeline-slider.section-{{ section.id }} .timeline-left .line-row {
  opacity: 0;
  transform: translate3d(0, 14px, 0);
  transition: opacity 600ms ease, transform 600ms ease;
  will-change: opacity, transform;
}

.timeline-slider.section-{{ section.id }} .timeline-left .line-row.is-visible {
  opacity: 1;
  transform: translate3d(0, 0, 0);
}

/* line fade-in */
.timeline-slider.section-{{ section.id }} .timeline-left:after {
  opacity: 0;
  transition: opacity 700ms ease;
  will-change: opacity;
}

/* when revealed */
.timeline-slider.section-{{ section.id }}.is-visible-line .timeline-left:after {
  opacity: 1;
}

/* reduced motion */
@media (prefers-reduced-motion: reduce) {
  .timeline-slider.section-{{ section.id }} .timeline-left .line-row {
    opacity: 1;
    transform: none;
    transition: none;
  }
  .timeline-slider.section-{{ section.id }} .timeline-left:after {
    opacity: 1;
    transition: none;
  }
}
{% endstyle %}

<section class="timeline-slider section-{{ section.id }} color-{{ section.settings.color_scheme }} background section-{{ section.id }}-paddings" data-timeline-section="{{ section.id }}">
  <div class="container timeline-slider__wrapper">

    <div class="section-header__line">
      {% if section.settings.heading != blank %}
        <h2
          class="title--section {% if section.settings.heading_size == 'medium' %}h2{% else %}h1{% endif %}"
          {{ section.shopify_attributes }}
        >
          {{ section.settings.heading }}
        </h2>
      {% endif %}
      {% if section.settings.description != blank %}
        <div class="rte">{{ section.settings.description }}</div>
      {% endif %}
    </div>

    <div class="timeline-row" data-timeline-trigger>
      <div class="timeline-left">
        {% for block in section.blocks %}
          <div class="line-row" data-timeline-row>
            <div class="badge-title-wrap">
              {% if block.settings.badge %}
                <div class="badge-red button button--primary">{{ block.settings.badge }}</div>
              {% endif %}

              {% if block.settings.title %}
                <h3 class="timeline-title">{{ block.settings.title }}</h3>
              {% endif %}
            </div>

            {% if block.settings.text %}
              <p class="timeline-text">{{ block.settings.text }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>

      <div class="timeline-right">
        <div class="timeline-swiper" id="slider-{{ section.id }}">
          <div class="swiper-wrapper">
            {% for block in section.blocks %}
              {% if block.settings.image != blank or block.settings.image2 != blank %}
                <div class="swiper-slide">
                  <div>
                    <img src="{{ block.settings.image | image_url: width: 800 }}" width="" height="" alt="{{ block.settings.image.alt }}" loading="lazy">
                  </div>
                  <div>
                    <img src="{{ block.settings.image2 | image_url: width: 800 }}" width="" height="" alt="{{ block.settings.image2.alt }}" loading="lazy">
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
          <div class="swiper-pagination"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Scroll reveal (stagger + line fade-in) -->
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const section = document.querySelector('.timeline-slider.section-{{ section.id }}');
    if (!section) return;

    // Prevent double-init in theme editor
    if (section.dataset.timelineAnimInit === "1") return;
    section.dataset.timelineAnimInit = "1";

    const rows = Array.from(section.querySelectorAll("[data-timeline-row]"));
    if (!rows.length) return;

    const triggerEl = section.querySelector("[data-timeline-trigger]") || section;
    const STAGGER_MS = 160; // 100â€“220

    const io = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (!entry.isIntersecting) return;

      section.classList.add("is-visible-header");
      setTimeout(() => {
        section.classList.add("is-visible-right");
      }, 120);

        // reveal rows
        rows.forEach((row, i) => {
          row.style.transitionDelay = `${i * STAGGER_MS}ms`;
          row.classList.add("is-visible");
        });


    // reveal header + right + vertical line
    section.classList.add("is-visible-header");
    section.classList.add("is-visible-right");
    section.classList.add("is-visible-line");

        io.disconnect();
      });
    }, {
      threshold: 0.2,
      // ðŸ”¥ delay it so it doesn't pre-play before you reach the section
      rootMargin: "0px 0px -5% 0px"
    });

    io.observe(triggerEl);
  });
  </script>

  <!-- âœ… Swiper init (fade) -->
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const selector = "#slider-{{ section.id }}";

    // Prevent double-init if Shopify re-renders sections
    if (document.querySelector(selector)?.classList.contains("swiper-initialized")) return;

    new Swiper(selector, {
      slidesPerView: 1,
      spaceBetween: 0,
      loop: true,

      effect: "fade",
      fadeEffect: { crossFade: true },

      speed: 1200,

      autoplay: {
        delay: 2000,
        disableOnInteraction: false
      },

      pagination: {
        el: selector + " .swiper-pagination",
        type: "progressbar"
      }
    });
  });
  </script>
</section>

{% schema %}
{
  "name": "Timeline Slider Section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "default": "background-2",
      "label": "t:sections.all.color_scheme.label"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "medium",
          "label": "t:sections.rich-text.blocks.heading.settings.heading_size.options__1.label"
        },
        {
          "value": "large",
          "label": "t:sections.rich-text.blocks.heading.settings.heading_size.options__2.label"
        }
      ],
      "default": "medium",
      "label": "t:sections.rich-text.blocks.heading.settings.heading_size.label"
    }
  ],
  "blocks": [
    {
      "type": "step",
      "name": "Timeline Step",
      "settings": [
        {
          "type": "text",
          "id": "badge",
          "label": "Badge Text",
          "default": "Month 1"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Progress Update"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Description"
        },
        { "type": "image_picker", "id": "image", "label": "Image 1" },
        { "type": "image_picker", "id": "image2", "label": "Image 2" }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Timeline Slider Section",
      "category": "Custom"
    }
  ]
}
{% endschema %}
